VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "mscomctl.ocx"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.OCX"
Object = "{C932BA88-4374-101B-A56C-00AA003668DC}#1.1#0"; "MSMASK32.OCX"
Object = "{00025600-0000-0000-C000-000000000046}#5.1#0"; "crystl32.ocx"
Begin VB.Form Form112 
   BackColor       =   &H00404040&
   Caption         =   "นับสต๊อก ตาม Store"
   ClientHeight    =   7605
   ClientLeft      =   60
   ClientTop       =   450
   ClientWidth     =   11835
   LinkTopic       =   "Form1"
   MDIChild        =   -1  'True
   ScaleHeight     =   7605
   ScaleWidth      =   11835
   WindowState     =   2  'Maximized
   Begin Crystal.CrystalReport Crystal108 
      Left            =   5895
      Top             =   2610
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal107 
      Left            =   5310
      Top             =   2565
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal106 
      Left            =   4680
      Top             =   2565
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal105 
      Left            =   4050
      Top             =   2610
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal104 
      Left            =   3420
      Top             =   2565
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal103 
      Left            =   2835
      Top             =   2565
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal102 
      Left            =   2160
      Top             =   2610
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin Crystal.CrystalReport Crystal101 
      Left            =   1575
      Top             =   2565
      _ExtentX        =   741
      _ExtentY        =   741
      _Version        =   348160
      WindowControlBox=   -1  'True
      WindowMaxButton =   -1  'True
      WindowMinButton =   -1  'True
      PrintFileLinesPerPage=   60
      WindowShowNavigationCtls=   -1  'True
      WindowShowCancelBtn=   -1  'True
      WindowShowPrintBtn=   -1  'True
      WindowShowExportBtn=   -1  'True
      WindowShowZoomCtl=   -1  'True
      WindowShowProgressCtls=   -1  'True
      WindowShowPrintSetupBtn=   -1  'True
      WindowShowRefreshBtn=   -1  'True
   End
   Begin VB.PictureBox PICQTYConfirm 
      BackColor       =   &H00404040&
      Height          =   8475
      Left            =   0
      ScaleHeight     =   8415
      ScaleWidth      =   11790
      TabIndex        =   104
      Top             =   0
      Visible         =   0   'False
      Width           =   11850
      Begin VB.CommandButton CMDReportItemRec 
         Caption         =   "พิมพ์รายการรับยอด"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   6930
         TabIndex        =   115
         Top             =   6480
         Width           =   1320
      End
      Begin VB.CheckBox CHKSelectAll 
         BackColor       =   &H00404040&
         Caption         =   "เลือกทั้งหมด"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   180
         TabIndex        =   111
         Top             =   6255
         Value           =   1  'Checked
         Width           =   2220
      End
      Begin VB.CommandButton CMDRecQTYCancel 
         Caption         =   "ปิด"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   10260
         TabIndex        =   109
         Top             =   6480
         Width           =   1320
      End
      Begin VB.CommandButton CMDRecQTYOK 
         Caption         =   "บันทึกรับยอด"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   8595
         TabIndex        =   108
         Top             =   6480
         Width           =   1320
      End
      Begin MSComctlLib.ListView ListViewItemConfirm 
         Height          =   5370
         Left            =   180
         TabIndex        =   105
         Top             =   675
         Width           =   11400
         _ExtentX        =   20108
         _ExtentY        =   9472
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   16777215
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   9
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "ลำดับ"
            Object.Width           =   1235
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "รหัสสินค้า"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Text            =   "ชื่อสินค้า"
            Object.Width           =   4410
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   3
            Text            =   "นับได้"
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   4
            Text            =   "OnHand"
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   5
            Text            =   "ผลต่าง"
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   6
            Text            =   "หน่วย"
            Object.Width           =   1411
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   7
            Text            =   "ต้นทุน"
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   8
            Text            =   "รวมผลต่างต้นทุน"
            Object.Width           =   2293
         EndProperty
      End
      Begin VB.Label Label56 
         BackStyle       =   0  'Transparent
         Caption         =   "รายการ สินค้าที่นับสต๊อกของแต่ละ RowID ที่ยอมรับผลการนับ"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   -1  'True
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   330
         Left            =   180
         TabIndex        =   106
         Top             =   270
         Width           =   5145
      End
   End
   Begin VB.PictureBox PICHelp 
      BackColor       =   &H00404040&
      ForeColor       =   &H00FFFFFF&
      Height          =   8250
      Left            =   0
      ScaleHeight     =   8190
      ScaleWidth      =   9585
      TabIndex        =   74
      Top             =   0
      Visible         =   0   'False
      Width           =   9645
      Begin VB.PictureBox Picture4 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         ForeColor       =   &H80000008&
         Height          =   60
         Left            =   -45
         ScaleHeight     =   30
         ScaleWidth      =   9795
         TabIndex        =   103
         Top             =   2025
         Width           =   9825
      End
      Begin VB.CommandButton CMDClosePICHelp 
         Caption         =   "Close"
         Height          =   240
         Left            =   8865
         TabIndex        =   83
         Top             =   45
         Width           =   645
      End
      Begin VB.Label Label58 
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มที่แสดงรายการสินค้าให้เราเลือกรับยอดว่านับได้ตามจำนวนนี้จริง ๆ เพื่อทำการขอโอนต่อไป"
         ForeColor       =   &H00FFFFFF&
         Height          =   375
         Left            =   2025
         TabIndex        =   113
         Top             =   4725
         Width           =   7035
      End
      Begin VB.Label Label57 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "5. ปุ่มรับยอด :"
         ForeColor       =   &H000000FF&
         Height          =   375
         Left            =   585
         TabIndex        =   112
         Top             =   4725
         Width           =   1320
      End
      Begin VB.Label Label55 
         BackStyle       =   0  'Transparent
         Caption         =   "การบันทึกผลครั้งแรกให้เลือกประเภทการนับเป็นแบบปกติ แต่กรณีที่ทำการ Recount ให้เลือก แบบ Recount"
         ForeColor       =   &H00FFFFFF&
         Height          =   465
         Left            =   1980
         TabIndex        =   102
         Top             =   6975
         Width           =   7530
      End
      Begin VB.Label Label54 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "ประเภทการนับ :"
         ForeColor       =   &H000000FF&
         Height          =   285
         Left            =   405
         TabIndex        =   101
         Top             =   6975
         Width           =   1500
      End
      Begin VB.Label Label53 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มรายงานตรวจสอบ : "
         ForeColor       =   &H000000FF&
         Height          =   285
         Left            =   225
         TabIndex        =   100
         Top             =   6615
         Width           =   1725
      End
      Begin VB.Label Label52 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มรายงานเคลื่อนไหว :"
         ForeColor       =   &H000000FF&
         Height          =   330
         Left            =   225
         TabIndex        =   99
         Top             =   6255
         Width           =   1680
      End
      Begin VB.Label Label51 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มยกเลิก :"
         ForeColor       =   &H000000FF&
         Height          =   285
         Left            =   180
         TabIndex        =   98
         Top             =   5535
         Width           =   1725
      End
      Begin VB.Label Label50 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "6. ปุ่มทำใบขอโอน :"
         ForeColor       =   &H000000FF&
         Height          =   285
         Left            =   405
         TabIndex        =   97
         Top             =   5130
         Width           =   1500
      End
      Begin VB.Label Label49 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "4. ปุ่มปิดยอดตรวจนับ : "
         ForeColor       =   &H000000FF&
         Height          =   240
         Left            =   315
         TabIndex        =   96
         Top             =   4185
         Width           =   1635
      End
      Begin VB.Label Label48 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "2. ปุ่มสรุปผลตรวจนับ : "
         ForeColor       =   &H000000FF&
         Height          =   285
         Left            =   225
         TabIndex        =   95
         Top             =   3105
         Width           =   1725
      End
      Begin VB.Label Label47 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "3. ปุ่ม Recount :"
         ForeColor       =   &H000000FF&
         Height          =   285
         Left            =   720
         TabIndex        =   94
         Top             =   3645
         Width           =   1185
      End
      Begin VB.Label Label46 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "1. ปุ่มบันทึกข้อมูล :"
         ForeColor       =   &H000000FF&
         Height          =   240
         Left            =   675
         TabIndex        =   93
         Top             =   2790
         Width           =   1230
      End
      Begin VB.Label Label45 
         BackStyle       =   0  'Transparent
         Caption         =   "รายละเอียด ปุ่มต่าง ๆ "
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   -1  'True
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   240
         Left            =   225
         TabIndex        =   92
         Top             =   2340
         Width           =   3165
      End
      Begin VB.Label Label44 
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มพิมพ์รายละเอียดของการนับสต๊อกของสินค้าในแตละ Row"
         ForeColor       =   &H00FFFFFF&
         Height          =   330
         Left            =   1980
         TabIndex        =   91
         Top             =   6615
         Width           =   5595
      End
      Begin VB.Label Label43 
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มที่พิมพ์รายการสินค้าที่เคลื่อนไหวระหว่างวันของ Row และวันที่ต้องการดู"
         ForeColor       =   &H00FFFFFF&
         Height          =   330
         Left            =   1980
         TabIndex        =   90
         Top             =   6255
         Width           =   5145
      End
      Begin VB.Label Label42 
         BackStyle       =   0  'Transparent
         Caption         =   $"Form112.frx":0000
         ForeColor       =   &H00FFFFFF&
         Height          =   645
         Left            =   1980
         TabIndex        =   89
         Top             =   5535
         Width           =   7395
      End
      Begin VB.Label Label41 
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มสุดท้ายของกระบวนการ ใช้พิมพ์เอกสารขอโอนสินค้า"
         ForeColor       =   &H00FFFFFF&
         Height          =   375
         Left            =   1980
         TabIndex        =   88
         Top             =   5130
         Width           =   7305
      End
      Begin VB.Label Label40 
         BackStyle       =   0  'Transparent
         Caption         =   $"Form112.frx":00D4
         ForeColor       =   &H00FFFFFF&
         Height          =   465
         Left            =   1980
         TabIndex        =   87
         Top             =   4185
         Width           =   7350
      End
      Begin VB.Label Label39 
         BackStyle       =   0  'Transparent
         Caption         =   "ปุ่มที่ทำการคำนวณผลการตรวจนับของสินค้าแต่ละรายการใน  Row นั้น ๆ  ก่อนกดปุ่มนี้ ต้องบันทึกข้อมูลใก้เรียบร้อยก่อน"
         ForeColor       =   &H00FFFFFF&
         Height          =   465
         Left            =   1980
         TabIndex        =   86
         Top             =   3105
         Width           =   7395
      End
      Begin VB.Label Label38 
         BackStyle       =   0  'Transparent
         Caption         =   $"Form112.frx":0189
         ForeColor       =   &H00FFFFFF&
         Height          =   465
         Left            =   1980
         TabIndex        =   85
         Top             =   3645
         Width           =   7350
      End
      Begin VB.Label Label37 
         BackStyle       =   0  'Transparent
         Caption         =   " ปุ่มที่ใช้บันทึกผลการนับสต๊อกที่เราคีย์ไว้ ให้บันทึกทุกครั้งเมื่อคีย์ข้อมูลเสร็จ หรือได้ข้อมูลตามที่ต้องการแล้ว"
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   1935
         TabIndex        =   84
         Top             =   2790
         Width           =   7440
      End
      Begin VB.Label Label36 
         BackStyle       =   0  'Transparent
         Caption         =   "Hot Keys"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   14.25
            Charset         =   222
            Weight          =   700
            Underline       =   -1  'True
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   420
         Left            =   225
         TabIndex        =   82
         Top             =   90
         Width           =   1545
      End
      Begin VB.Label Label35 
         BackStyle       =   0  'Transparent
         Caption         =   "F7 : เปลี่ยนที่เก็บสินค้า"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   4545
         TabIndex        =   81
         Top             =   1260
         Width           =   2040
      End
      Begin VB.Label Label34 
         BackStyle       =   0  'Transparent
         Caption         =   "F6 : เปลี่ยน RowID"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   4545
         TabIndex        =   80
         Top             =   945
         Width           =   1950
      End
      Begin VB.Label Label33 
         BackStyle       =   0  'Transparent
         Caption         =   "F5 : บันทึกข้อมูล"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   4545
         TabIndex        =   79
         Top             =   630
         Width           =   1770
      End
      Begin VB.Label Label32 
         BackStyle       =   0  'Transparent
         Caption         =   "F4 : เปลี่ยน Store"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   225
         TabIndex        =   78
         Top             =   1620
         Width           =   1950
      End
      Begin VB.Label Label31 
         BackStyle       =   0  'Transparent
         Caption         =   "F3 : เปลี่ยนคลัง"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   225
         TabIndex        =   77
         Top             =   1260
         Width           =   1680
      End
      Begin VB.Label Label30 
         BackStyle       =   0  'Transparent
         Caption         =   "F2 : เปลี่ยนรอบการนับสต๊อก"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   225
         TabIndex        =   76
         Top             =   945
         Width           =   2445
      End
      Begin VB.Label Label29 
         BackStyle       =   0  'Transparent
         Caption         =   "F1 : เปิดหน้า HotKeys"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   225
         TabIndex        =   75
         Top             =   630
         Width           =   2355
      End
   End
   Begin VB.PictureBox PIC101 
      BackColor       =   &H00808080&
      Height          =   7620
      Left            =   0
      ScaleHeight     =   7560
      ScaleWidth      =   11835
      TabIndex        =   9
      Top             =   0
      Visible         =   0   'False
      Width           =   11895
      Begin VB.PictureBox PICCount 
         BackColor       =   &H00404040&
         Height          =   4920
         Left            =   4275
         ScaleHeight     =   4860
         ScaleWidth      =   4770
         TabIndex        =   41
         Top             =   1080
         Visible         =   0   'False
         Width           =   4830
         Begin VB.CommandButton CMDCloseCount 
            Caption         =   "ปิด"
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   222
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   375
            Left            =   3690
            TabIndex        =   46
            Top             =   4230
            Width           =   870
         End
         Begin VB.CommandButton CMDSelectCount 
            Caption         =   "เลือก"
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   222
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   375
            Left            =   2655
            TabIndex        =   45
            Top             =   4230
            Width           =   870
         End
         Begin MSComctlLib.ListView ListViewCountID 
            Height          =   2895
            Left            =   225
            TabIndex        =   44
            Top             =   945
            Width           =   4335
            _ExtentX        =   7646
            _ExtentY        =   5106
            View            =   3
            LabelEdit       =   1
            LabelWrap       =   -1  'True
            HideSelection   =   -1  'True
            FullRowSelect   =   -1  'True
            GridLines       =   -1  'True
            _Version        =   393217
            ForeColor       =   -2147483640
            BackColor       =   -2147483643
            BorderStyle     =   1
            Appearance      =   0
            NumItems        =   5
            BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Text            =   "ลำดับ"
               Object.Width           =   1147
            EndProperty
            BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   1
               Text            =   "รหัส"
               Object.Width           =   2646
            EndProperty
            BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   2
               Text            =   "คำอธิบาย"
               Object.Width           =   5292
            EndProperty
            BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   3
               Text            =   "วันที่เริ่ม"
               Object.Width           =   2646
            EndProperty
            BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   4
               Text            =   "วันที่สิ้นสุด"
               Object.Width           =   2646
            EndProperty
         End
         Begin VB.TextBox TextSearchCount 
            Appearance      =   0  'Flat
            Height          =   330
            Left            =   1260
            TabIndex        =   42
            Top             =   225
            Width           =   1770
         End
         Begin VB.Label Label17 
            Alignment       =   1  'Right Justify
            BackStyle       =   0  'Transparent
            Caption         =   "ค้นหา :"
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   222
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H8000000E&
            Height          =   285
            Left            =   225
            TabIndex        =   43
            Top             =   225
            Width           =   1005
         End
      End
      Begin VB.CommandButton CMDSearch 
         Height          =   285
         Left            =   5175
         Picture         =   "Form112.frx":0225
         Style           =   1  'Graphical
         TabIndex        =   40
         Top             =   1080
         Width           =   330
      End
      Begin VB.CommandButton CMDCloseCountMaster 
         Caption         =   "ออก"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   6030
         TabIndex        =   39
         Top             =   3465
         Width           =   1500
      End
      Begin MSComCtl2.DTPicker DTPDate2 
         Height          =   330
         Left            =   6210
         TabIndex        =   25
         Top             =   2745
         Width           =   1410
         _ExtentX        =   2487
         _ExtentY        =   582
         _Version        =   393216
         Format          =   61407233
         CurrentDate     =   39416
      End
      Begin MSComCtl2.DTPicker DTPDate1 
         Height          =   330
         Left            =   4275
         TabIndex        =   24
         Top             =   2745
         Width           =   1410
         _ExtentX        =   2487
         _ExtentY        =   582
         _Version        =   393216
         Format          =   61407233
         CurrentDate     =   39416
      End
      Begin VB.TextBox TextCountDescription 
         Appearance      =   0  'Flat
         Height          =   870
         Left            =   4275
         MultiLine       =   -1  'True
         TabIndex        =   12
         Top             =   1620
         Width           =   4830
      End
      Begin MSMask.MaskEdBox MEBCountID 
         Height          =   285
         Left            =   4275
         TabIndex        =   11
         Top             =   1080
         Width           =   870
         _ExtentX        =   1535
         _ExtentY        =   503
         _Version        =   393216
         Appearance      =   0
         MaxLength       =   5
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Mask            =   "##/##"
         PromptChar      =   "_"
      End
      Begin VB.CommandButton CMDSaveCountID 
         Caption         =   "บันทึกรอบของการนับ"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   4275
         TabIndex        =   14
         Top             =   3465
         Width           =   1500
      End
      Begin VB.Image Image1 
         Height          =   750
         Left            =   0
         Picture         =   "Form112.frx":05F2
         Top             =   0
         Visible         =   0   'False
         Width           =   2160
      End
      Begin VB.Label Label8 
         Alignment       =   2  'Center
         BackStyle       =   0  'Transparent
         Caption         =   "ถึง "
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   240
         Left            =   5760
         TabIndex        =   26
         Top             =   2790
         Width           =   420
      End
      Begin VB.Label Label7 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "ช่วงเวลาดำเนินการ :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   375
         Left            =   2430
         TabIndex        =   23
         Top             =   2745
         Width           =   1725
      End
      Begin VB.Label Label2 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "คำอธิบาย :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   375
         Left            =   2295
         TabIndex        =   13
         Top             =   1620
         Width           =   1860
      End
      Begin VB.Label Label1 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "รอบของการนับ :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   2655
         TabIndex        =   10
         Top             =   1080
         Width           =   1500
      End
   End
   Begin VB.PictureBox PICProcessCount 
      BackColor       =   &H00000000&
      Height          =   7620
      Left            =   0
      ScaleHeight     =   7560
      ScaleWidth      =   11790
      TabIndex        =   52
      Top             =   0
      Visible         =   0   'False
      Width           =   11850
      Begin VB.OptionButton Option2 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         Caption         =   "สินค้ามูลค่าผลต่างเกินเป็น % "
         ForeColor       =   &H80000008&
         Height          =   285
         Left            =   3780
         TabIndex        =   119
         Top             =   6525
         Visible         =   0   'False
         Width           =   2400
      End
      Begin VB.OptionButton Option1 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         Caption         =   "สินค้ามูลค่าผลต่างเกิน"
         ForeColor       =   &H80000008&
         Height          =   285
         Left            =   180
         TabIndex        =   118
         Top             =   6525
         Value           =   -1  'True
         Visible         =   0   'False
         Width           =   1860
      End
      Begin VB.TextBox Text2 
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   6300
         MaxLength       =   2
         TabIndex        =   117
         Top             =   6525
         Visible         =   0   'False
         Width           =   690
      End
      Begin VB.TextBox TextDiffValue 
         Alignment       =   1  'Right Justify
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   2115
         TabIndex        =   116
         Text            =   "500.00"
         Top             =   6525
         Visible         =   0   'False
         Width           =   1185
      End
      Begin VB.CommandButton CMDProcessClose 
         Caption         =   "ปิด"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   10125
         TabIndex        =   65
         Top             =   6435
         Width           =   1455
      End
      Begin VB.CommandButton CMDItemRecount 
         Caption         =   "Recount"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   510
         Left            =   8460
         TabIndex        =   54
         Top             =   6435
         Width           =   1455
      End
      Begin MSComctlLib.ListView ListViewProcessCount 
         Height          =   5280
         Left            =   180
         TabIndex        =   53
         Top             =   990
         Width           =   11400
         _ExtentX        =   20108
         _ExtentY        =   9313
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         HideColumnHeaders=   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   0
         NumItems        =   8
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "ลำดับ"
            Object.Width           =   1058
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "รหัสสินค้า"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Text            =   "ชื่อสินค้า"
            Object.Width           =   5292
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   3
            Text            =   "สรุปจ.น.ตรวจนับ"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   4
            Text            =   "OnHand"
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   5
            Text            =   "ผลต่าง"
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   6
            Text            =   "%ผลต่าง"
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   7
            Text            =   "หน่วย"
            Object.Width           =   1764
         EndProperty
      End
      Begin VB.Label Label28 
         Alignment       =   1  'Right Justify
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "%ผลต่าง"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000005&
         Height          =   285
         Left            =   9540
         TabIndex        =   72
         Top             =   720
         Width           =   1050
      End
      Begin VB.Label Label26 
         BackStyle       =   0  'Transparent
         Caption         =   "รายการสินค้า"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   -1  'True
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   240
         Left            =   180
         TabIndex        =   63
         Top             =   360
         Width           =   1905
      End
      Begin VB.Label Label27 
         Alignment       =   1  'Right Justify
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "ผลต่าง"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   8190
         TabIndex        =   62
         Top             =   720
         Width           =   1365
      End
      Begin VB.Label Label25 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "หน่วยนับ"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   10575
         TabIndex        =   61
         Top             =   720
         Width           =   1020
      End
      Begin VB.Label Label24 
         Alignment       =   1  'Right Justify
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "OnHand"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   6795
         TabIndex        =   60
         Top             =   720
         Width           =   1410
      End
      Begin VB.Label Label23 
         Alignment       =   1  'Right Justify
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "สรุปจ.น.ตรวจนับ"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   5265
         TabIndex        =   59
         Top             =   720
         Width           =   1545
      End
      Begin VB.Label Label22 
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "ชื่อสินค้า"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   2295
         TabIndex        =   58
         Top             =   720
         Width           =   3000
      End
      Begin VB.Label Label21 
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "รหัสสินค้า"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   810
         TabIndex        =   57
         Top             =   720
         Width           =   1500
      End
      Begin VB.Label Label19 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BackColor       =   &H00808080&
         BorderStyle     =   1  'Fixed Single
         Caption         =   "ลำดับ"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   180
         TabIndex        =   55
         Top             =   720
         Width           =   645
      End
   End
   Begin VB.PictureBox PICShowItemExist 
      BackColor       =   &H00000000&
      Height          =   7620
      Left            =   0
      ScaleHeight     =   7560
      ScaleWidth      =   11925
      TabIndex        =   48
      Top             =   0
      Visible         =   0   'False
      Width           =   11985
      Begin VB.CommandButton CMDCloseShowItemExist 
         Caption         =   "ปิด"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   10260
         TabIndex        =   121
         Top             =   540
         Width           =   735
      End
      Begin MSComctlLib.ListView ListViewShowItemExist 
         Height          =   3165
         Left            =   720
         TabIndex        =   49
         Top             =   900
         Width           =   10275
         _ExtentX        =   18124
         _ExtentY        =   5583
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   0
         NumItems        =   8
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "ลำดับ"
            Object.Width           =   1147
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "เลขที่เอกสาร"
            Object.Width           =   3175
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Text            =   "วันที่เอกสาร"
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   3
            Text            =   "RowID"
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   4
            Text            =   "ที่เก็บ"
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   5
            Text            =   "จ.น.ตามที่เก็บ"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   6
            Text            =   "จ.น.ทั้งหมดที่นับได้"
            Object.Width           =   3528
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   7
            Text            =   "หน่วย"
            Object.Width           =   1764
         EndProperty
      End
      Begin VB.Label Label18 
         BackStyle       =   0  'Transparent
         Caption         =   "รายการผลการตรวจนับสินค้า"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   -1  'True
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   330
         Left            =   720
         TabIndex        =   50
         Top             =   585
         Width           =   2310
      End
   End
   Begin VB.PictureBox Picture3 
      Height          =   60
      Left            =   0
      ScaleHeight     =   0
      ScaleWidth      =   11790
      TabIndex        =   70
      Top             =   6210
      Width           =   11850
   End
   Begin VB.CommandButton CMDCloseProcess 
      Caption         =   "1 : สรุปผลนับ"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   1530
      TabIndex        =   64
      ToolTipText     =   "ประมวลผลของการนับสต๊อกของ Row ที่กำลังเปิดอยู่"
      Top             =   6345
      Width           =   1320
   End
   Begin VB.CommandButton CMDTransfer 
      Caption         =   "5 : ทำใบขอโอน"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   7200
      TabIndex        =   51
      ToolTipText     =   "Gen ใบขอโอนสินค้า"
      Top             =   6345
      Width           =   1410
   End
   Begin VB.CommandButton CMDAddCountID 
      Caption         =   "เพิ่มรอบการนับสต๊อก"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   10305
      TabIndex        =   47
      Top             =   6930
      Width           =   1320
   End
   Begin VB.CommandButton CMDProcess 
      Caption         =   "2 : Recount"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   2880
      TabIndex        =   35
      ToolTipText     =   "ออกรายงาน รายการสินค้าที่ต้องทำการนับใหม่"
      Top             =   6345
      Width           =   1320
   End
   Begin VB.CommandButton CMDSearchDocno 
      Caption         =   "ค้นหาเอกสาร"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   7200
      TabIndex        =   22
      ToolTipText     =   "ส่งรายการสินค้า คำนวณยอดสินค้า"
      Top             =   6930
      Width           =   1410
   End
   Begin VB.CommandButton CMDExit 
      Caption         =   "ล้างหน้าจอ"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   10305
      TabIndex        =   21
      Top             =   6345
      Width           =   1320
   End
   Begin VB.CommandButton CMDCancel 
      Caption         =   "ยกเลิกเอกสาร"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   5715
      TabIndex        =   20
      ToolTipText     =   "ยกเลิกเอกสารการบันทึกผลการตรวจนับ"
      Top             =   6930
      Width           =   1455
   End
   Begin VB.CommandButton CMDSave 
      Caption         =   "F5-บันทึกข้อมูล"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   180
      TabIndex        =   19
      ToolTipText     =   "บันทึกข้อมูล"
      Top             =   6345
      Width           =   1320
   End
   Begin MSComctlLib.ListView ListViewItemList 
      Height          =   3390
      Left            =   180
      TabIndex        =   8
      Top             =   2745
      Width           =   11490
      _ExtentX        =   20267
      _ExtentY        =   5980
      View            =   3
      LabelEdit       =   1
      LabelWrap       =   -1  'True
      HideSelection   =   -1  'True
      FullRowSelect   =   -1  'True
      GridLines       =   -1  'True
      _Version        =   393217
      ForeColor       =   -2147483640
      BackColor       =   -2147483643
      BorderStyle     =   1
      Appearance      =   0
      NumItems        =   12
      BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Text            =   "ลำดับ"
         Object.Width           =   1147
      EndProperty
      BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         SubItemIndex    =   1
         Text            =   "รหัสสินค้า"
         Object.Width           =   2822
      EndProperty
      BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         SubItemIndex    =   2
         Text            =   "ชื่อสินค้า"
         Object.Width           =   5292
      EndProperty
      BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Alignment       =   1
         SubItemIndex    =   3
         Text            =   "นับครั้งที่1"
         Object.Width           =   2293
      EndProperty
      BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Alignment       =   1
         SubItemIndex    =   4
         Text            =   "นับครั้งที่2"
         Object.Width           =   2293
      EndProperty
      BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Alignment       =   1
         SubItemIndex    =   5
         Text            =   "นับครั้งที่3"
         Object.Width           =   2293
      EndProperty
      BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         SubItemIndex    =   6
         Text            =   "หน่วย"
         Object.Width           =   1764
      EndProperty
      BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Alignment       =   1
         SubItemIndex    =   7
         Text            =   "OnHand"
         Object.Width           =   2293
      EndProperty
      BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Alignment       =   1
         SubItemIndex    =   8
         Text            =   "ผลต่าง"
         Object.Width           =   2293
      EndProperty
      BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         Alignment       =   1
         SubItemIndex    =   9
         Text            =   "% ผลต่าง"
         Object.Width           =   2117
      EndProperty
      BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         SubItemIndex    =   10
         Text            =   "ที่เก็บ"
         Object.Width           =   2293
      EndProperty
      BeginProperty ColumnHeader(12) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
         SubItemIndex    =   11
         Text            =   "ที่อยู่ข้อมูล"
         Object.Width           =   5292
      EndProperty
   End
   Begin VB.CommandButton CMDStockMovement 
      Caption         =   "สินค้าที่เคลื่อนไหว"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   180
      TabIndex        =   69
      ToolTipText     =   "รายงาน เคลื่อนไหวสินค้าของแต่ละ Row ในแต่ละวัน เพื่อใช้ประกอบการ Recount"
      Top             =   6930
      Width           =   1320
   End
   Begin VB.CommandButton CMDCloseCountStock 
      Caption         =   "3 : ปิดยอดตรวจ"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   4230
      TabIndex        =   71
      ToolTipText     =   "ปิดกระบวนการนับของแต่ละ Row "
      Top             =   6345
      Width           =   1455
   End
   Begin VB.CommandButton CMDCheckItemCount 
      Caption         =   "รายงานสรุปผลนับ"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   1530
      TabIndex        =   73
      ToolTipText     =   "ก่อนพิมพ์รายงานให้สรุปผลตรวจนับก่อน"
      Top             =   6930
      Width           =   1320
   End
   Begin VB.CommandButton CMDItemMultiShelf 
      Caption         =   "รายงานสินค้าหลายที่เก็บ"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   2880
      TabIndex        =   110
      ToolTipText     =   "ตรวจสินค้า ที่อยู่หลายที่เก็บเพื่อความสะดวกในการเก็บ Slot Tag"
      Top             =   6930
      Width           =   1320
   End
   Begin VB.CommandButton CMDConfirmQTY 
      Caption         =   "4 : รับยอดสินค้า"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   5715
      TabIndex        =   107
      ToolTipText     =   "ยอมรับยอดของรายการสินค้าในแต่ละ Row ที่ได้ทำการนับสต๊อก"
      Top             =   6345
      Width           =   1455
   End
   Begin VB.PictureBox Picture2 
      BackColor       =   &H00808080&
      Height          =   960
      Left            =   0
      ScaleHeight     =   900
      ScaleWidth      =   11790
      TabIndex        =   15
      Top             =   0
      Width           =   11850
      Begin MSMask.MaskEdBox MEBPercentDiff 
         Height          =   285
         Left            =   11115
         TabIndex        =   32
         Top             =   450
         Width           =   330
         _ExtentX        =   582
         _ExtentY        =   503
         _Version        =   393216
         Appearance      =   0
         MaxLength       =   2
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Mask            =   "##"
         PromptChar      =   "_"
      End
      Begin MSComCtl2.DTPicker DTPDocDate 
         Height          =   285
         Left            =   3510
         TabIndex        =   1
         Top             =   450
         Width           =   1500
         _ExtentX        =   2646
         _ExtentY        =   503
         _Version        =   393216
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Format          =   61407233
         CurrentDate     =   39416
      End
      Begin MSMask.MaskEdBox MEBCountID1 
         Height          =   285
         Left            =   1440
         TabIndex        =   0
         Top             =   450
         Width           =   1095
         _ExtentX        =   1931
         _ExtentY        =   503
         _Version        =   393216
         Appearance      =   0
         MaxLength       =   5
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Mask            =   "##/##"
         PromptChar      =   "_"
      End
      Begin VB.ComboBox CMBStore 
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   315
         Left            =   7965
         Style           =   2  'Dropdown List
         TabIndex        =   3
         Top             =   450
         Width           =   1320
      End
      Begin VB.ComboBox CMBWHCode 
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   315
         Left            =   5895
         Style           =   2  'Dropdown List
         TabIndex        =   2
         Top             =   450
         Width           =   1005
      End
      Begin VB.Label Label15 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "%"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H8000000E&
         Height          =   285
         Left            =   11340
         TabIndex        =   34
         Top             =   540
         Width           =   285
      End
      Begin VB.Label Label14 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "DiffRecount <="
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   9495
         TabIndex        =   33
         Top             =   450
         Width           =   1545
      End
      Begin VB.Image IMGCancel 
         Height          =   300
         Left            =   11115
         Picture         =   "Form112.frx":307C
         Top             =   45
         Visible         =   0   'False
         Width           =   570
      End
      Begin VB.Image IMGConfirm 
         Height          =   300
         Left            =   11115
         Picture         =   "Form112.frx":35B8
         Top             =   45
         Visible         =   0   'False
         Width           =   570
      End
      Begin VB.Image IMGNew 
         Height          =   300
         Left            =   11115
         Picture         =   "Form112.frx":3A61
         Top             =   45
         Width           =   570
      End
      Begin VB.Label Label11 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "ชั้นเก็บ :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   7110
         TabIndex        =   29
         Top             =   450
         Width           =   825
      End
      Begin VB.Label Label10 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "วันที่นับ :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   2700
         TabIndex        =   28
         Top             =   450
         Width           =   780
      End
      Begin VB.Label Label9 
         BackStyle       =   0  'Transparent
         Caption         =   "รอบของการนับ :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   285
         Left            =   90
         TabIndex        =   27
         Top             =   450
         Width           =   1410
      End
      Begin VB.Label Label5 
         BackStyle       =   0  'Transparent
         Caption         =   "กำหนดแหล่งที่มาของ สินค้า"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   222
            Weight          =   700
            Underline       =   -1  'True
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   330
         Left            =   90
         TabIndex        =   17
         Top             =   45
         Width           =   2265
      End
      Begin VB.Label Label3 
         Alignment       =   1  'Right Justify
         BackStyle       =   0  'Transparent
         Caption         =   "คลัง :"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   240
         Left            =   5265
         TabIndex        =   16
         Top             =   450
         Width           =   555
      End
   End
   Begin VB.PictureBox Picture1 
      Height          =   60
      Left            =   -180
      ScaleHeight     =   0
      ScaleWidth      =   12150
      TabIndex        =   38
      Top             =   2025
      Width           =   12210
   End
   Begin VB.Frame Frame1 
      Appearance      =   0  'Flat
      BackColor       =   &H00404040&
      Caption         =   "ประเภทการนับ"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   915
      Left            =   9900
      TabIndex        =   66
      Top             =   1035
      Width           =   1770
      Begin VB.OptionButton OPT002 
         BackColor       =   &H00404040&
         Caption         =   "ReCount"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   270
         TabIndex        =   68
         Top             =   540
         Width           =   1275
      End
      Begin VB.OptionButton OPT001 
         BackColor       =   &H00404040&
         Caption         =   "นับปกติ"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   222
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00FFFFFF&
         Height          =   285
         Left            =   270
         TabIndex        =   67
         Top             =   225
         Value           =   -1  'True
         Width           =   1275
      End
   End
   Begin VB.TextBox TextQty 
      Alignment       =   1  'Right Justify
      Appearance      =   0  'Flat
      BackColor       =   &H00000000&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   14.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000080FF&
      Height          =   435
      Left            =   5940
      TabIndex        =   7
      Text            =   "0.00"
      Top             =   1485
      Width           =   2715
   End
   Begin VB.TextBox TextShelf 
      Appearance      =   0  'Flat
      Height          =   330
      Left            =   5940
      TabIndex        =   5
      Top             =   1035
      Width           =   1455
   End
   Begin VB.TextBox TextScanBarcode 
      Appearance      =   0  'Flat
      Height          =   330
      Left            =   1485
      TabIndex        =   6
      Top             =   1485
      Width           =   2040
   End
   Begin VB.TextBox TextRow 
      Appearance      =   0  'Flat
      Height          =   330
      Left            =   1485
      TabIndex        =   4
      Top             =   1035
      Width           =   1095
   End
   Begin VB.CommandButton CMDPrintItemMultiRow 
      Caption         =   "รายงาน สินค้าหลายRow"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   4230
      TabIndex        =   114
      Top             =   6930
      Width           =   1455
   End
   Begin VB.CommandButton CMDHandHeld 
      Caption         =   "6.MC3000"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   465
      Left            =   8640
      TabIndex        =   122
      Top             =   6345
      Width           =   1410
   End
   Begin VB.Label LBLShowDetailsAddItem 
      Alignment       =   2  'Center
      Appearance      =   0  'Flat
      BackColor       =   &H00000000&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   12
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   330
      Left            =   180
      TabIndex        =   120
      Top             =   2160
      Width           =   11490
   End
   Begin VB.Label Label20 
      Alignment       =   2  'Center
      BackColor       =   &H8000000D&
      BorderStyle     =   1  'Fixed Single
      Caption         =   "ลำดับ"
      Height          =   330
      Left            =   0
      TabIndex        =   56
      Top             =   0
      Width           =   1050
   End
   Begin VB.Label Label16 
      Alignment       =   1  'Right Justify
      BackStyle       =   0  'Transparent
      Caption         =   "ที่เก็บ :"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000E&
      Height          =   330
      Left            =   4590
      TabIndex        =   37
      Top             =   1035
      Width           =   1275
   End
   Begin VB.Label Label4 
      Alignment       =   1  'Right Justify
      BackStyle       =   0  'Transparent
      Caption         =   "RowID :"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000E&
      Height          =   240
      Left            =   315
      TabIndex        =   36
      Top             =   1035
      Width           =   1095
   End
   Begin VB.Label Label13 
      Alignment       =   1  'Right Justify
      BackStyle       =   0  'Transparent
      Caption         =   "จำนวนที่นับได้ :"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000E&
      Height          =   285
      Left            =   4545
      TabIndex        =   31
      Top             =   1485
      Width           =   1320
   End
   Begin VB.Label Label12 
      BackStyle       =   0  'Transparent
      Caption         =   "ScanBarCode :"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000E&
      Height          =   285
      Left            =   135
      TabIndex        =   30
      Top             =   1485
      Width           =   1320
   End
   Begin VB.Label Label6 
      BackStyle       =   0  'Transparent
      Caption         =   "รายการ สินค้า"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   222
         Weight          =   700
         Underline       =   -1  'True
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H8000000E&
      Height          =   285
      Left            =   180
      TabIndex        =   18
      Top             =   2520
      Width           =   1275
   End
End
Attribute VB_Name = "Form112"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit
Dim vCheckSameValue As Integer
Dim vMemIndexDup As Integer
Dim vQuery As String
Dim vGetIsConfirm As Integer
Dim vGetIsFinish As Integer
Dim vGetIsCancel As Integer
Dim vGetIsRecQTY As Integer
Dim vIsOpen As Integer
Dim vMemCheckScanKey As Integer
Dim vMemCheckKeyQTY As Integer
Dim vCheckCountExist As Integer
Dim vIsOtherRow As Integer

Private Sub CHKSelectAll_Click()
Dim i As Integer

If Me.CHKSelectAll.Value = 1 Then
   For i = 1 To Me.ListViewItemConfirm.ListItems.Count
   Me.ListViewItemConfirm.ListItems(i).Checked = True
   Next i
Else
   For i = 1 To Me.ListViewItemConfirm.ListItems.Count
   Me.ListViewItemConfirm.ListItems(i).Checked = False
   Next i
End If
End Sub

Private Sub CMBStore_Click()
On Error Resume Next

vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
gConnection.Execute vQuery
Call vGetCheckOpenDoc
Me.TextRow.SetFocus
End Sub

Private Sub CMBStore_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMBWHCode_Click()
Dim vWHCode As String
 
On Error Resume Next

vWHCode = Trim(CMBWHCode.Text)
Call GetShelf(vWHCode)
Call GetStore(vWHCode)

vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
gConnection.Execute vQuery
Call vGetCheckOpenDoc

If vIsOpen = 0 Then
Me.TextRow.Text = ""
End If
Me.TextShelf.Text = ""
End Sub

Private Sub CMBWHCode_KeyDown(KeyCode As Integer, Shift As Integer)
Dim vWHCode As String

On Error Resume Next

If KeyCode = 13 Then
   vWHCode = Trim(CMBWHCode.Text)
   Call GetShelf(vWHCode)
   Call GetStore(vWHCode)
   
   vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
   gConnection.Execute vQuery
   Call vGetCheckOpenDoc
End If

On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDAddCountID_Click()
Me.PIC101.Visible = True
Me.MEBCountID.SetFocus
End Sub

Private Sub CMDAddCountID_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDCancel_Click()
Dim vDocNo As String
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vAnswer As Integer

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then
   If vIsOpen = 1 Then
      If vGetIsCancel = 0 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
         vCountID = Me.MEBCountID1.Text
         vWHCode = Me.CMBWHCode.Text
         vStoreCode = Me.CMBStore.Text
         vRowID = Me.TextRow.Text
         vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
         
         vAnswer = MsgBox("คุณต้องการยกเลิกเอกสารนี้ใช่หรือไม่", vbYesNo, "Send Information Message")
         If vAnswer = 6 Then
            vQuery = "exec dbo.USP_MB_CancelCountItemStore '" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "' "
            gConnection.Execute vQuery
            
            Call vClearScreen
            MsgBox "ยกเลิกเอกสารเรียบร้อยแล้วครับ", vbInformation, "Send Error Message"
            Me.TextRow.SetFocus
         End If
      ElseIf vGetIsCancel = 1 Then
         MsgBox "เอกสารไม่สามารถยกเลิกได้ เนื่องจากถูกยกเลิกไปแล้ว", vbCritical, "Send Error Message"
      ElseIf vGetIsConfirm = 1 And vGetIsFinish = 0 Then
         MsgBox "เอกสารไม่สามารถยกเลิกได้ เนื่องจากถูกอนุมัติไปแล้ว", vbCritical, "Send Error Message"
      ElseIf vGetIsConfirm = 1 And vGetIsFinish = 1 Then
         MsgBox "เอกสารไม่สามารถยกเลิกได้ เนื่องจากถูกปิดการนับสต๊อกไปแล้ว", vbCritical, "Send Error Message"
      End If
   Else
      MsgBox "เอกสารยังไม่ได้บันทึกข้อมูลการตรวจนับไม่สามารถยกเลิกได้", vbCritical, "Send Error Message"
   End If
End If

End Sub

Private Sub CMDCancel_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDCheckItemCount_Click()
Dim vRecordset As New ADODB.Recordset
Dim vReportName As String
Dim vDocNo As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vDocDate As String
Dim vID As Integer

On Error Resume Next

If Me.ListViewItemList.ListItems.Count > 0 Then

'MsgBox "ก่อนดูรายงานให้กดสรุปผลตรวจนับก่อนเพื่อความถูกต้องของข้อมูล", vbInformation, "Send Information Message"

vQuery = "select reportname from bcreportname where repid = 382 and reptype = 'MB' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
    vReportName = Trim(vRecordset.Fields("reportname").Value)
End If
vRecordset.Close

vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
vCountID = Me.MEBCountID1.Text
vWHCode = Me.CMBWHCode.Text
vStoreCode = Me.CMBStore.Text
vRowID = Me.TextRow.Text
vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
         
With Crystal104
.ReportFileName = vReportName & ".rpt"
.ParameterFields(0) = "@vDocNo;" & vDocNo & ";true "
.ParameterFields(1) = "@vDocDate;" & vDocDate & ";true "
.Destination = crptToWindow
.WindowState = crptMaximized
.Action = 1
End With
Else
   MsgBox "ไม่มีข้อมูลออกกรายงาน ต้องกรอกเงื่อนไขการดูรายงานให้เรียบร้อยก่อน", vbCritical, "Send Error Message"
End If
End Sub

Private Sub CMDCheckItemCount_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDCloseCount_Click()
PICCount.Visible = False
End Sub

Private Sub CMDCloseCountMaster_Click()
PIC101.Visible = False
End Sub

Public Sub vClearScreen()
On Error Resume Next

vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
gConnection.Execute vQuery

Me.DTPDocDate.Value = Now
'Me.CMBWHCode.Text = "014"
'Me.CMBStore.Text = "AVL"
Me.MEBPercentDiff.Mask = "__"
Me.TextRow.Text = ""
Me.TextShelf.Text = ""
Me.TextScanBarcode.Text = ""
Me.TextQty.Text = ""
Me.ListViewItemList.ListItems.Clear
Me.OPT001.Value = True
Me.OPT002.Value = False
Me.IMGCancel.Visible = False
Me.IMGConfirm.Visible = False
Me.IMGNew.Visible = True
vCheckSameValue = 0
vMemIndexDup = 0

vRemStockOpen = 0
vRemStockDocNo = ""
vRemDocDate = ""
vRemCountID = ""
vRemWHCode = ""
vRemStoreCode = ""
vRemRowID = ""
 
vGetIsConfirm = 0
vGetIsFinish = 0
vGetIsCancel = 0
vGetIsRecQTY = 0

Me.LBLShowDetailsAddItem.Caption = ""

vIsOpen = 0

Me.MEBCountID1.SetFocus

Call Me.EnableButton

End Sub

Private Sub CMDCloseCountStock_Click()
Dim vDocNo As String
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vRecordset As New ADODB.Recordset
Dim vCountTotal As Integer

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then

vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
vCountID = Me.MEBCountID1.Text
vWHCode = Me.CMBWHCode.Text
vStoreCode = Me.CMBStore.Text
vRowID = Me.TextRow.Text

vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
         
vQuery = "select count(itemcode) as counttotal from npmaster.dbo.TB_MB_CountItemStoreSub2 where docno = '" & vDocNo & "' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
   vCountTotal = vRecordset.Fields("counttotal").Value
End If
vRecordset.Close


If vCountTotal <= 0 Then
   MsgBox "กรุณากดสรุปผลอีกครั้งก่อนปิดยอด เพราะไม่มีรายการสินค้าอยู่ในตารางข้อมูลนับสต็อก", vbCritical, "Send Error Message"
   Exit Sub
End If
         
vQuery = "exec dbo.USP_IC_StockcountSummarize '" & vDocNo & "','" & vDocDate & "' "
gConnection.Execute vQuery
         
   If vIsOpen = 1 Then
      If vGetIsCancel = 0 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
         vCountID = Me.MEBCountID1.Text
         vWHCode = Me.CMBWHCode.Text
         vStoreCode = Me.CMBStore.Text
         vRowID = Me.TextRow.Text
         
         If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
            MsgBox "ไม่สามารถปิดยอดการนับย้อนหลังได้ กรุณาติดต่อแผนกคอมฯ ", vbCritical, "Send Error Message"
            Exit Sub
         End If
         

         
         vQuery = "exec dbo.USP_IC_StockcountSummarize '" & vDocNo & "','" & vDocDate & "' "
         gConnection.Execute vQuery
         
         vQuery = "exec dbo.USP_MB_UpdateIsConfirmCountStock '" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "' "
         gConnection.Execute vQuery
         
         vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
         gConnection.Execute vQuery
         
         Call vGetDataCountStock
         
         vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',1 "
         gConnection.Execute vQuery
         
         'Call vClearScreen
         MsgBox "ปิดยอดตรวจนับเรียบร้อยแล้ว", vbInformation, "Send Error Message"
         Me.TextRow.SetFocus
      ElseIf vGetIsCancel = 1 Then
         MsgBox "เอกสารที่ถูกยกเลิกไม่สามารถปิดข้อมูลการตรวจนับได้", vbCritical, "Send Error Message"
      ElseIf vGetIsConfirm = 1 And vGetIsFinish = 0 Then
         MsgBox "ปิดยอดตรวจนับเรียบร้อยไปแล้ว", vbCritical, "Send Error Message"
      ElseIf vGetIsConfirm = 1 And vGetIsFinish = 1 Then
         MsgBox "ปิดยอดตรวจนับเรียบร้อยไปแล้ว", vbInformation, "Send Error Message"
      End If
   Else
      MsgBox "เอกสารยังไม่ได้บันทึกข้อมูลการตรวจนับไม่สามารถปิดยอดตรวจนับได้", vbCritical, "Send Error Message"
   End If
End If
End Sub

Private Sub CMDCloseCountStock_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDClosePICHelp_Click()
Me.PICHelp.Visible = False
Me.MEBCountID1.SetFocus
End Sub

Private Sub CMDClosePICHelp_KeyDown(KeyCode As Integer, Shift As Integer)
If KeyCode = 27 Then
   Me.PICHelp.Visible = False
End If
End Sub

Private Sub CMDCloseProcess_Click()
Dim vDocNo As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vDocDate As String

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" Then
   If vIsOpen = 1 Then
   
   If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
      MsgBox "ไม่สามารถสรุปผลข้อมูลการนับย้อนหลังได้ กรุณาติดต่อแผนกคอมฯ ", vbCritical, "Send Error Message"
      Exit Sub
   End If

      If vGetIsCancel = 1 Then
         MsgBox "เอกสารถูกยกเลิกไปแล้วไม่สามารถสรุปยอดการตรวจนับได้", vbCritical, "Send Error Message"
         Exit Sub
      End If
      
      If vGetIsConfirm = 1 And vGetIsFinish = 0 Then
         MsgBox "เอกสารถูกสรุปยอดการตรวจนับไปแล้ว", vbCritical, "Send Error Message"
         Exit Sub
      End If
      
      If vGetIsCancel = 1 And vGetIsFinish = 1 Then
         MsgBox "เอกสารถูกทำใบขอโอนไปแล้ว ไม่สามารถสรุปยอดการตรวจนับได้", vbCritical, "Send Error Message"
         Exit Sub
      End If
      
      
   
      vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
      vCountID = Me.MEBCountID1.Text
      vWHCode = Me.CMBWHCode.Text
      vStoreCode = Me.CMBStore.Text
      vRowID = Me.TextRow.Text
      
      vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
   
      vQuery = "exec dbo.USP_IC_StockcountSummarize '" & vDocNo & "','" & vDocDate & "' "
      gConnection.Execute vQuery
      
      Me.ListViewProcessCount.ListItems.Clear
      Me.PICProcessCount.Visible = False
      
      'vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
      'gConnection.Execute vQuery
   
      MsgBox "สรุปยอดตรวจนับเรียบร้อยแล้ว", vbInformation, "Send Error Message"
   
      'Call vClearScreen
   Else
     MsgBox "ไม่สามารถสรุปยอดตรวจนับได้ เนื่องจากยังไม่ได้บันทึกข้อมูล", vbCritical, "Send Error Message"
   End If
End If
End Sub

Private Sub CMDCountQTY_Click()

End Sub

Private Sub CMDCloseProcess_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDCloseShowItemExist_Click()
Me.PICShowItemExist.Visible = False
End Sub

Private Sub CMDConfirmQTY_Click()
Dim vRecordset As New ADODB.Recordset
Dim vDocNo As String
Dim vDocDate As String
Dim vListItem As ListItem
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim i As Integer
Dim vQty As Double
Dim vOnHand As Double

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then

   If vGetIsCancel = 1 Then
      MsgBox "ไม่สามารถรับยอดเอกสารที่ถูกยกเลิกแล้วได้", vbCritical, "Send Error Message"
      Exit Sub
   End If

   If vGetIsConfirm = 0 Then
      MsgBox "ไม่สามารถรับยอด เอกสารที่ยังไม่ได้ปิดยอดการตรวจนับได้", vbCritical, "Send Error Message"
      Exit Sub
   End If
   
   If vGetIsConfirm = 1 And vGetIsFinish = 1 Then
      MsgBox "ไม่สามารถรับยอด เอกสารที่ทำใบขอโอนแล้วได้", vbCritical, "Send Error Message"
      Exit Sub
   End If
   
   If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
      'MsgBox "ไม่สามารถรับผลย้อนหลังได้ กรุณาติดต่อแผนกคอมฯ ", vbCritical, "Send Error Message"
      MsgBox "วันนี้จะปล่อยให้รับยอดย้อนหลังได้ วันต่อ ๆ ไปจะไม่ปล่อยให้รับแล้วนะครับ พี่สมชาย ", vbCritical, "Send Error Message"
      Me.CMDRecQTYOK.Enabled = True
   End If
   
   If vGetIsRecQTY = 1 Then
      MsgBox "ไม่สามารถรับยอด เอกสารที่ทำการรับยอดไปแล้วได้", vbCritical, "Send Error Message"
      Me.CMDRecQTYOK.Enabled = False
   ElseIf vGetIsRecQTY = 0 And Me.DTPDocDate.Day = Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
      Me.CMDRecQTYOK.Enabled = True
   End If

   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID

   Me.PICQTYConfirm.Visible = True

   vQuery = "exec dbo.USP_MB_CountTotalItemStockProcess  '" & vDocNo & "','" & vDocDate & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      Me.ListViewItemConfirm.ListItems.Clear
      vRecordset.MoveFirst
      i = 1
      While Not vRecordset.EOF
      Set vListItem = Me.ListViewItemConfirm.ListItems.Add(, , i)
      vListItem.SubItems(1) = vRecordset.Fields("itemcode").Value
      vListItem.SubItems(2) = vRecordset.Fields("itemname").Value
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vListItem.SubItems(3) = Format(0, "##,##0.00")
      Else
         vListItem.SubItems(3) = Format(vRecordset.Fields("qty").Value, "##,##0.00")
      End If
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vListItem.SubItems(4) = Format(0, "##,##0.00")
      Else
         vListItem.SubItems(4) = Format(vRecordset.Fields("onhand").Value, "##,##0.00")
      End If
      If IsNull(vRecordset.Fields("diffqty").Value) Then
         vListItem.SubItems(5) = Format(0, "##,##0.00")
      Else
         vListItem.SubItems(5) = Format(vRecordset.Fields("diffqty").Value, "##,##0.00")
      End If
      vListItem.SubItems(6) = vRecordset.Fields("unitcode").Value
      vListItem.SubItems(7) = Format(vRecordset.Fields("cost").Value, "##,##0.00")
      vListItem.SubItems(8) = Format(vRecordset.Fields("diffcost").Value, "##,##0.00")
      
      If vRecordset.Fields("isrecqty").Value = 1 And vGetIsRecQTY = 1 Then
         vListItem.Checked = True
      ElseIf vRecordset.Fields("isrecqty").Value = 0 And vGetIsRecQTY = 1 Then
         vListItem.Checked = False
      ElseIf vRecordset.Fields("isrecqty").Value = 0 And vGetIsRecQTY = 0 Then
         vListItem.Checked = True
      End If
      vRecordset.MoveNext
      i = i + 1
      Wend
   End If
   vRecordset.Close
   
   
   Dim n As Integer
   Dim vCheckDiffQty As Integer
   Dim vCheckDiffQtySumAmount As Double
   Dim vCheckDiffQtyAmount As Double
   
   
   For n = 1 To Me.ListViewItemConfirm.ListItems.Count
   vCheckDiffQty = Me.ListViewItemConfirm.ListItems(n).SubItems(5)
   vCheckDiffQtyAmount = Me.ListViewItemConfirm.ListItems(n).SubItems(8)
   
   If vCheckDiffQtyAmount < 0 Then
      vCheckDiffQtySumAmount = vCheckDiffQtyAmount * -1
   Else
      vCheckDiffQtySumAmount = vCheckDiffQtyAmount
   End If
   
      If vCheckDiffQty <> 0 And vCheckDiffQtySumAmount < 500 Then
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(1).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(2).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(3).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(4).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(5).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(6).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(7).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(8).ForeColor = "&H00000040"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(9).ForeColor = "&H00000040"
      ElseIf vCheckDiffQty <> 0 And vCheckDiffQtySumAmount >= 500 Then
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(1).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(2).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(3).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(4).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(5).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(6).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(7).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(8).ForeColor = "&H000000FF"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(9).ForeColor = "&H000000FF"
      Else
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(1).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(2).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(3).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(4).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(5).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(6).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(7).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(8).ForeColor = "&H00000000"
         Me.ListViewItemConfirm.ListItems.Item(n).ListSubItems(9).ForeColor = "&H00000000"
      End If
   Next n
   
End If
End Sub

Private Sub CMDExit_Click()
On Error Resume Next

   Call Me.vClearScreen
   'vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
   'gConnection.Execute vQuery
   'Unload Form112
End Sub

Private Sub CMDExit_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Public Sub PrintQTYConfirm()
Dim vRecordset As New ADODB.Recordset
Dim vReportName As String
Dim vDocNo As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vDocDate As String

On Error Resume Next

vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
vCountID = Me.MEBCountID1.Text
vWHCode = Me.CMBWHCode.Text
vStoreCode = Me.CMBStore.Text
vRowID = Me.TextRow.Text
vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID

vQuery = "select reportname from bcreportname where repid = 381 and reptype = 'MB' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
    vReportName = Trim(vRecordset.Fields("reportname").Value)
End If
vRecordset.Close
         
With Crystal106
.ReportFileName = vReportName & ".rpt"
.ParameterFields(0) = "@vDocNo;" & vDocNo & ";true "
.ParameterFields(1) = "@vDocDate;" & vDocDate & ";true "
.Destination = crptToWindow
.WindowState = crptMaximized
.Action = 1
End With

End Sub

Private Sub CMDHandHeld_Click()
Dim vRecordset As New ADODB.Recordset
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim i As Integer
Dim vCountStock As Double
Dim vOnHand As Double
Dim vListItem As ListItem

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then
   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   
   vQuery = "exec dbo.USP_NP_SearchCountStockFromMC3000 '" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
   
      vRecordset.MoveFirst
      i = 1
      While Not vRecordset.EOF
      Set vListItem = Me.ListViewItemList.ListItems.Add(, , i)
      vListItem.SubItems(1) = vRecordset.Fields("itemcode").Value
      vListItem.SubItems(2) = vRecordset.Fields("itemname").Value
      If vRecordset.Fields("count1").Value <> -1 Then
         vListItem.SubItems(3) = Format(vRecordset.Fields("count1").Value, "##,##0.00")
      Else
         vListItem.SubItems(3) = ""
      End If
      If vRecordset.Fields("count2").Value <> -1 Then
         vListItem.SubItems(4) = Format(vRecordset.Fields("count2").Value, "##,##0.00")
      Else
         vListItem.SubItems(4) = ""
      End If
      If vRecordset.Fields("count3").Value <> -1 Then
         vListItem.SubItems(5) = Format(vRecordset.Fields("count3").Value, "##,##0.00")
      Else
         vListItem.SubItems(5) = ""
      End If
      If IsNull(vRecordset.Fields("countqty").Value) Then
         vCountStock = 0
      Else
         vCountStock = vRecordset.Fields("countqty").Value
      End If
      
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vOnHand = 0
      Else
         vOnHand = vRecordset.Fields("onhand").Value
      End If
      
      vListItem.SubItems(6) = vRecordset.Fields("unitcode").Value
      vListItem.SubItems(7) = Format(vOnHand, "##,##0.00")
      vListItem.SubItems(8) = Format(vOnHand - vCountStock, "##,##0.00")
      If vCountStock <> 0 Then
         If vOnHand <> 0 Then
            vListItem.SubItems(9) = Format((100 - (vCountStock * 100) / vOnHand), "##,##0.00")
         Else
            vListItem.SubItems(9) = Format(100, "##,##0.00")
         End If
      Else
        vListItem.SubItems(9) = Format(100, "##,##0.00")
      End If
      vListItem.SubItems(10) = vRecordset.Fields("shelfcode").Value
      vListItem.SubItems(11) = vRecordset.Fields("pathfilename").Value
      
      vRecordset.MoveNext
      i = i + 1
      Wend
      
   End If
   vRecordset.Close
   
End If
End Sub

Private Sub CMDHandHeldClose_Click()
'Me.PICHandHeld.Visible = False
End Sub

Private Sub CMDHandHeldSelect_Click()
Dim i As Integer
Dim n As Integer

Dim vItemCode As String
Dim vUnitCode As String
Dim v


If Me.ListViewItemList.ListItems.Count > 0 Then

End If
End Sub

Private Sub CMDItemMultiShelf_Click()
Dim vRecordset As New ADODB.Recordset
Dim vReportName As String
Dim vDocNo As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vDocDate As String
Dim vID As Integer

On Error Resume Next

If Me.ListViewItemList.ListItems.Count > 0 And Me.TextRow.Text <> "" Then
vQuery = "select reportname from bcreportname where repid = 380 and reptype = 'MB' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
    vReportName = Trim(vRecordset.Fields("reportname").Value)
End If
vRecordset.Close

vRowID = Me.TextRow.Text

         
With Crystal105
.ReportFileName = vReportName & ".rpt"
.ParameterFields(0) = "@RowCode;" & vRowID & ";true "
.Destination = crptToWindow
.WindowState = crptMaximized
.Action = 1
End With
Else
   MsgBox "ไม่มีข้อมูลออกกรายงาน ต้องกรอกเงื่อนไขการดูรายงานให้เรียบร้อยก่อน", vbCritical, "Send Error Message"
End If
End Sub

Private Sub CMDItemRecount_Click()
Dim vRecordset As New ADODB.Recordset
Dim vReportName As String
Dim vDocNo As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vDocDate As String
Dim vID As Integer

On Error Resume Next

vQuery = "select reportname from bcreportname where repid = 375 and reptype = 'MB' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
    vReportName = Trim(vRecordset.Fields("reportname").Value)
End If
vRecordset.Close

vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
vCountID = Me.MEBCountID1.Text
vWHCode = Me.CMBWHCode.Text
vStoreCode = Me.CMBStore.Text
vRowID = Me.TextRow.Text
vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
vID = 1
         
With Crystal103
.ReportFileName = vReportName & ".rpt"
.ParameterFields(0) = "@vDocNo;" & vDocNo & ";true "
.ParameterFields(1) = "@vDocDate;" & vDocDate & ";true "
.ParameterFields(2) = "@vID;" & vID & ";true "
.Destination = crptToWindow
.WindowState = crptMaximized
.Action = 1
End With
End Sub

Private Sub CMDPrintItemMultiRow_Click()
Dim vRecordset As New ADODB.Recordset
Dim vReportName As String

On Error Resume Next

vQuery = "select reportname from bcreportname where repid = 384 and reptype = 'MB' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
    vReportName = Trim(vRecordset.Fields("reportname").Value)
End If
vRecordset.Close
 
With Crystal108
.ReportFileName = vReportName & ".rpt"
.Destination = crptToWindow
.WindowState = crptMaximized
.Action = 1
End With

End Sub

Private Sub CMDProcess_Click()
Dim vRecordset As New ADODB.Recordset
Dim vDocNo As String
Dim vDocDate As String
Dim vListItem As ListItem
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim i As Integer
Dim vQty As Double
Dim vOnHand As Double

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then


If vGetIsCancel = 1 Then
   MsgBox "ไม่สามารถประมวลผล เอกสารที่ถูกยกเลิกแล้วได้", vbCritical, "Send Error Message"
   Exit Sub
End If

If vGetIsConfirm = 1 And vGetIsFinish = 0 Then
   MsgBox "ไม่สามารถประมวลผล เอกสารที่อนุมัติแล้วได้", vbCritical, "Send Error Message"
   Exit Sub
End If

If vGetIsConfirm = 1 And vGetIsFinish = 1 Then
   MsgBox "ไม่สามารถประมวลผล เอกสารที่ทำใบขอโอนแล้วได้", vbCritical, "Send Error Message"
   Exit Sub
End If

   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID

   Me.PICProcessCount.Visible = True

   vQuery = "exec dbo.USP_MB_CountItemStockProcess  '" & vDocNo & "','" & vDocDate & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      Me.ListViewProcessCount.ListItems.Clear
      vRecordset.MoveFirst
      i = 1
      While Not vRecordset.EOF
      Set vListItem = Me.ListViewProcessCount.ListItems.Add(, , i)
      vListItem.SubItems(1) = vRecordset.Fields("itemcode").Value
      vListItem.SubItems(2) = vRecordset.Fields("itemname").Value
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vListItem.SubItems(3) = Format(0, "##,##0.00")
         vQty = 0
      Else
         vListItem.SubItems(3) = Format(vRecordset.Fields("qty").Value, "##,##0.00")
         vQty = vRecordset.Fields("qty").Value
      End If
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vListItem.SubItems(4) = Format(0, "##,##0.00")
         vOnHand = 0
      Else
         vListItem.SubItems(4) = Format(vRecordset.Fields("onhand").Value, "##,##0.00")
         vOnHand = vRecordset.Fields("onhand").Value
      End If
      If IsNull(vRecordset.Fields("diffqty").Value) Then
         vListItem.SubItems(5) = Format(0, "##,##0.00")
      Else
         vListItem.SubItems(5) = Format(vRecordset.Fields("diffqty").Value, "##,##0.00")
      End If
      If vOnHand <> 0 Then
         vListItem.SubItems(6) = Format((100 - (vQty * 100) / vOnHand), "##,##0.00")
      Else
         vListItem.SubItems(6) = Format(100, "##,##0.00")
      End If
      
      vListItem.SubItems(7) = vRecordset.Fields("unitcode").Value
      vRecordset.MoveNext
      i = i + 1
      Wend
   End If
   vRecordset.Close
   
   If Me.DTPDocDate.Day = Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
      vQuery = "exec dbo.USP_IC_StockcountSummarize '" & vDocNo & "','" & vDocDate & "' "
      gConnection.Execute vQuery
   Else
     MsgBox "รายงาน สินค้าที่ต้องตรวจนับใหม่จะได้ยอด OnHand ณ วันที่นับเหมือนเดิมไม่ได้ ยอด OnHand ณ ปัจจุบัน", vbCritical, "Send Information"
   End If


      
End If

End Sub

Private Sub CMDProcess_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDProcessClose_Click()
PICProcessCount.Visible = False
End Sub

Private Sub CMDRecQTYCancel_Click()
Me.PICQTYConfirm.Visible = False
End Sub

Private Sub CMDRecQTYOK_Click()
Dim i As Integer
Dim vDocNo As String
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vItemCode As String


If Me.ListViewItemConfirm.ListItems.Count > 0 Then
   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
   
   For i = 1 To Me.ListViewItemConfirm.ListItems.Count
   vItemCode = Me.ListViewItemConfirm.ListItems(i).SubItems(1)
   If Me.ListViewItemConfirm.ListItems(i).Checked = True Then
      vQuery = "exec dbo.USP_MB_UpdateIsReceiveQTYCountStock '" & vDocNo & "','" & vDocDate & "','" & vWHCode & "','" & vStoreCode & "','" & vItemCode & "',1 "
      gConnection.Execute vQuery
   Else
      vQuery = "exec dbo.USP_MB_UpdateIsReceiveQTYCountStock '" & vDocNo & "','" & vDocDate & "','" & vWHCode & "','" & vStoreCode & "','" & vItemCode & "',0 "
      gConnection.Execute vQuery
   End If
   Next i
   MsgBox "บันทึกผลการรับยอดสินค้าเรียบร้อยแล้ว", vbCritical, "Send Information Message"
   Call PrintQTYConfirm
   Me.PICQTYConfirm.Visible = False
   Call vClearScreen
End If

End Sub

Private Sub CMDReportItemRec_Click()
Call PrintQTYConfirm
End Sub

Private Sub CMDSave_Click()
Dim vRecordset As New ADODB.Recordset

'Master

Dim vDocNo As String
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vIsConfirm As Integer
Dim vIsFinish As Integer
Dim vPercentDiff As Integer
Dim vIsReqTransfer As Integer
Dim vIsCancel As Integer
Dim vKeyCode As String

'Details

Dim vItemCode As String
Dim vItemName As String
Dim vShelfCode As String
Dim vShelfID As String
Dim vCount1 As Double
Dim vCount2 As Double
Dim vCount3 As Double
Dim vOnHand As Double
Dim vUnitCode As String
Dim vLineNumber As Integer
Dim vPathFileName As String

Dim i As Integer

If Me.MEBCountID1.Text <> "" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.ListViewItemList.ListItems.Count > 0 Then

If Me.DTPDocDate.Day > Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
   MsgBox "ไม่สามารถบันทึกข้อมูลของวันที่ล่วงหน้าได้", vbCritical, "Send Error Message"
   Exit Sub
End If

If vGetIsCancel = 1 Then
   MsgBox "ไม่สามารถบันทึกข้อมูลที่ถูกยกเลิกแล้วได้", vbCritical, "Send Error Message"
   Exit Sub
End If

If vGetIsConfirm = 1 And vGetIsFinish = 0 Then
   MsgBox "ไม่สามารถบันทึกข้อมูลที่อนุมัติแล้วได้", vbCritical, "Send Error Message"
   Exit Sub
End If

If vGetIsConfirm = 1 And vGetIsFinish = 1 Then
   MsgBox "ไม่สามารถบันทึกข้อมูลที่ทำใบขอโอนแล้วได้", vbCritical, "Send Error Message"
   Exit Sub
End If

   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   
   If Me.MEBPercentDiff.Text = "__" Then
      vPercentDiff = 0
   Else
       vPercentDiff = Me.MEBPercentDiff.Text
   End If

   vIsReqTransfer = 0
   vKeyCode = vUserID
   vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
   
   If Me.IMGNew.Visible = True Then
      vIsConfirm = 0
      vIsCancel = 0
      vIsFinish = 0
   ElseIf Me.IMGConfirm.Visible = True Then
      vIsConfirm = 1
      vIsCancel = 0
      vIsFinish = 0
   ElseIf Me.IMGCancel.Visible = True Then
      vIsConfirm = 0
      vIsCancel = 1
      vIsFinish = 0
   End If
   
   On Error GoTo ErrQuery
   
   vQuery = "begin tran"
   gConnection.Execute vQuery
   
   vQuery = "set dateformat dmy"
   gConnection.Execute vQuery
   
   vQuery = "exec dbo.USP_MB_InsertUpdateCountItemStore '" & vDocNo & "','" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "'," & vIsConfirm & "," & vIsFinish & "," & vPercentDiff & "," & vIsReqTransfer & "," & vIsCancel & ",'" & vKeyCode & "' "
   gConnection.Execute vQuery

   For i = 1 To Me.ListViewItemList.ListItems.Count
     vItemCode = Me.ListViewItemList.ListItems(i).SubItems(1)
     vItemName = Me.ListViewItemList.ListItems(i).SubItems(2)
     vShelfCode = Me.ListViewItemList.ListItems(i).SubItems(10)
     vLineNumber = i - 1
     
     If Me.ListViewItemList.ListItems(i).SubItems(3) = "" Then
        vCount1 = -1
     Else
        vCount1 = Me.ListViewItemList.ListItems(i).SubItems(3)
     End If
     If Me.ListViewItemList.ListItems(i).SubItems(4) = "" Then
        vCount2 = -1
     Else
        vCount2 = Me.ListViewItemList.ListItems(i).SubItems(4)
     End If
     If Me.ListViewItemList.ListItems(i).SubItems(5) = "" Then
        vCount3 = -1
     Else
        vCount3 = Me.ListViewItemList.ListItems(i).SubItems(5)
     End If
     
     vOnHand = Me.ListViewItemList.ListItems(i).SubItems(7)
     vUnitCode = Me.ListViewItemList.ListItems(i).SubItems(6)
     
     vPathFileName = Me.ListViewItemList.ListItems(i).SubItems(10)
     
     vQuery = "exec dbo.USP_MB_InsertCountItemStoreSub1 '" & vDocNo & "','" & vDocDate & "','" & vItemCode & "','" & vItemName & "','" & vShelfCode & "'," & vCount1 & "," & vCount2 & "," & vCount3 & "," & vOnHand & ",'" & vUnitCode & "'," & vLineNumber & " "
     gConnection.Execute vQuery
     
     If vPathFileName <> "" Then
     vQuery = "exec dbo.USP_NP_UpdateDataCountStockHandHeld '" & vItemCode & "','" & vWHCode & "','" & vShelfCode & "','" & vRowID & "','" & vShelfID & "', '" & vPathFileName & "'"
     gConnection.Execute vQuery
     End If
     
   Next i
   
   vQuery = "commit tran"
   gConnection.Execute vQuery
   
   MsgBox "บันทึกข้อมูลเรียบร้อยแล้ว เลขที่เอกสารคือ " & vDocNo & " ", vbInformation, "Send Information Message"
   Call vClearScreen
   Me.TextRow.SetFocus

End If

ErrQuery:
If Err.Description <> "" Then
   MsgBox Err.Description, vbCritical, "Send Error Message"
   vQuery = "rollback tran"
   gConnection.Execute vQuery
End If

End Sub

Private Sub CMDSave_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDSaveCountID_Click()
Dim vCountID As String
Dim vDescription As String
Dim vStartDate As String
Dim vEndDate As String

On Error Resume Next

If Me.MEBCountID.Text <> "" Then
   vCountID = Me.MEBCountID.Text
   vDescription = Me.TextCountDescription.Text
   vStartDate = Me.DTPDate1.Day & "/" & Me.DTPDate1.Month & "/" & Me.DTPDate1.Year
   vEndDate = Me.DTPDate2.Day & "/" & Me.DTPDate2.Month & "/" & Me.DTPDate2.Year
   
   vQuery = "exec dbo.USP_MB_InsertUpdateCountItemQTYMaster '" & vCountID & "','" & vDescription & "','" & vStartDate & "','" & vEndDate & "','" & vUserID & "' "
   gConnection.Execute (vQuery)
   MsgBox "บันทึกข้อมูลเรียบร้อยแล้ว", vbInformation, "Send Information Message"
   
   Me.MEBCountID.Text = "__/__"
   Me.TextCountDescription.Text = ""
   Me.DTPDate1.Value = Now
   Me.DTPDate2.Value = Now
   Me.MEBCountID.SetFocus
End If

End Sub

Private Sub CMDSearch_Click()
Dim vRecordset As New ADODB.Recordset
Dim vSearch As String
Dim vListCount As ListItem
Dim i As Integer

On Error Resume Next

PICCount.Visible = True
Me.TextSearchCount.SetFocus

Me.ListViewCountID.ListItems.Clear
vQuery = "exec dbo.USP_MB_SearchCountItemQTYMaster '' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
   vRecordset.MoveFirst
   i = 1
   While Not vRecordset.EOF
   Set vListCount = Me.ListViewCountID.ListItems.Add(, , i)
   vListCount.SubItems(1) = vRecordset.Fields("countid").Value
   vListCount.SubItems(2) = vRecordset.Fields("description").Value
   vListCount.SubItems(3) = vRecordset.Fields("startdate").Value
   vListCount.SubItems(4) = vRecordset.Fields("enddate").Value
   vRecordset.MoveNext
   Wend
   Me.ListViewCountID.SetFocus
End If
vRecordset.Close

End Sub

Private Sub CMDSearchDocno_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDSelectCount_Click()
Dim vIndex As Integer

On Error Resume Next

If Me.ListViewCountID.ListItems.Count > 0 Then
   vIndex = Me.ListViewCountID.SelectedItem.Index
   MEBCountID.Text = Me.ListViewCountID.ListItems(vIndex).SubItems(1)
   TextCountDescription.Text = Me.ListViewCountID.ListItems(vIndex).SubItems(2)
   Me.DTPDate1.Value = Me.ListViewCountID.ListItems(vIndex).SubItems(3)
   Me.DTPDate2.Value = Me.ListViewCountID.ListItems(vIndex).SubItems(4)
   Me.PICCount.Visible = False
End If
End Sub

Private Sub CMDStockMovement_Click()
Dim vRecordset As New ADODB.Recordset
Dim vReportName1 As String
Dim vReportName2 As String
Dim vRowID As String
Dim vDocDate As String

On Error Resume Next

If Me.TextRow.Text <> "" Then
   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vRowID = Me.TextRow.Text
   
   vQuery = "select reportname from bcreportname where repid = 373 and reptype = 'MB' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
       vReportName1 = Trim(vRecordset.Fields("reportname").Value)
   End If
   vRecordset.Close
   
   With Crystal101
   .ReportFileName = vReportName1 & ".rpt"
   .ParameterFields(0) = "@Date;" & vDocDate & ";true "
   .ParameterFields(1) = "@Row;" & vRowID & ";true "
   .Destination = crptToWindow
   .WindowState = crptMaximized
   .Action = 1
   End With
   
   vQuery = "select reportname from bcreportname where repid = 374 and reptype = 'MB' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
       vReportName2 = Trim(vRecordset.Fields("reportname").Value)
   End If
   vRecordset.Close
   
   With Crystal101
   .ReportFileName = vReportName2 & ".rpt"
   .ParameterFields(0) = "@Date;" & vDocDate & ";true "
   .ParameterFields(1) = "@Row;" & vRowID & ";true "
   .Destination = crptToWindow
   .WindowState = crptMaximized
   .Action = 1
   End With
   
   
End If
End Sub

Private Sub CMDStockMovement_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub CMDTransfer_Click()
Dim vRecordset As New ADODB.Recordset
Dim vDocNo As String
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vTransferNo As String
Dim vTransferDate As String

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then
   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   
   vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
   
   'If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
    '  MsgBox "ไม่สามารถทำใบขอโอน ย้อนหลังได้ กรุณาติดต่อแผนกคอมฯ ", vbCritical, "Send Error Message"
     ' Exit Sub
   'End If
   
   If vIsOpen = 1 Then
      If vGetIsCancel = 0 And vGetIsConfirm = 1 And vGetIsRecQTY = 1 And vGetIsFinish = 0 Then
      vQuery = "exec dbo. USP_IC_StockcountRequestTransf '" & vDocNo & "','" & vDocDate & "' "
      gConnection.Execute vQuery
      
      vQuery = "exec dbo.USP_MB_SearchTransferDocNo'" & vDocNo & "','" & vDocDate & "' "
      If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
         vTransferNo = vRecordset.Fields("docno").Value
         MsgBox "สร้างใบขอโอนเรียบร้อย ได้เลขที่ใบขอโอน   " & vRecordset.Fields("docno").Value & "", vbInformation, "Send Information"
      End If
      vRecordset.Close
          
      vQuery = "exec dbo.USP_MB_UpdateIsFinishCountStock '" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "' "
      gConnection.Execute vQuery
      
      vQuery = "exec dbo.USP_MB_SearchTransferDocNo'" & vDocNo & "','" & vDocDate & "' "
      If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
         vTransferNo = vRecordset.Fields("docno").Value
         vTransferDate = vRecordset.Fields("docdate").Value
      End If
      vRecordset.Close
         
      ElseIf vGetIsCancel = 1 Then
         MsgBox "เอกสารถูกยกเลิก ไม่สามารถทำใบขอโอนได้", vbCritical, "Send Error Message"
      ElseIf vGetIsConfirm = 0 Then
         MsgBox "เอกสารยังไม่ได้ปิดการนับสต๊อก ไม่สามารถทำใบขอโอนได้", vbCritical, "Send Error Message"
      ElseIf vGetIsRecQTY = 0 Then
         MsgBox "เอกสารยังไม่ได้ทำการรับยอดสินค้า ไม่สามารถทำใบขอโอนได้", vbCritical, "Send Error Message"
      ElseIf vGetIsFinish = 1 Then
         vQuery = "exec dbo.USP_MB_SearchTransferDocNo'" & vDocNo & "','" & vDocDate & "' "
         If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
            vTransferNo = vRecordset.Fields("docno").Value
            vTransferDate = vRecordset.Fields("docdate").Value
            MsgBox "ทำการสร้างใบขอโอนไปแล้ว ได้เลขที่ใบขอโอน   " & vRecordset.Fields("docno").Value & "", vbCritical, "Send Information"
         End If
         vRecordset.Close
         
      Call vClearScreen
      End If
      Call PrintReqTransferItem(vTransferNo, vTransferDate)
   Else
      MsgBox "เอกสารยังไม่ได้บันทึกข้อมูลการตรวจนับไม่สามารถทำใบขอโอนได้", vbCritical, "Send Error Message"
   End If
End If
End Sub


Public Sub PrintReqTransferItem(vDocNo As String, vDocDate As String)
Dim vRecordset As New ADODB.Recordset
Dim vReportName As String

On Error Resume Next

vQuery = "select reportname from bcreportname where repid = 383 and reptype = 'MB' "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
    vReportName = Trim(vRecordset.Fields("reportname").Value)
End If
vRecordset.Close

With Crystal107
.ReportFileName = vReportName & ".rpt"
.ParameterFields(0) = "@DocNo;" & vDocNo & ";true "
.ParameterFields(1) = "@DocDate;" & vDocDate & ";true "
.Destination = crptToWindow
.WindowState = crptMaximized
.Action = 1
End With

End Sub

Private Sub CMDTransfer_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub DTPDocDate_Change()
On Error Resume Next

Me.CMBWHCode.SetFocus
vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0"
gConnection.Execute vQuery
Call vGetCheckOpenDoc
Me.CMBWHCode.SetFocus
End Sub

Private Sub DTPDocDate_Click()
'Me.CMBWHCode.SetFocus
'vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
'gConnection.Execute vQuery
'Call vGetCheckOpenDoc

End Sub

Private Sub DTPDocDate_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 13 Then
   Me.CMBWHCode.SetFocus
   vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0"
   gConnection.Execute vQuery
   Call vGetCheckOpenDoc
   Me.CMBWHCode.SetFocus
End If

On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub Form_Load()
On Error Resume Next

Call GetWHCode
Me.DTPDocDate.Value = Now
Me.MEBCountID1.SelText = "01/53"
Me.TextRow.SetFocus
End Sub

Public Sub GetWHCode()
Dim vRecordset As New ADODB.Recordset
Dim vQuery As String

On Error Resume Next

Me.CMBWHCode.Clear
vQuery = "exec dbo.USP_MB_SearchWhCodeCode "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
        vRecordset.MoveFirst
        While Not vRecordset.EOF
        Me.CMBWHCode.AddItem Trim(vRecordset.Fields("whcode").Value)
        vRecordset.MoveNext
        Wend
End If
vRecordset.Close
Me.CMBWHCode.Text = "014"
End Sub

Public Sub GetStore(vWHCode As String)
Dim vRecordset As New ADODB.Recordset
Dim vQuery As String

On Error Resume Next

Me.CMBStore.Clear
vQuery = "exec dbo.USP_IV_ShelfList '" & vWHCode & "'  "
If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
        vRecordset.MoveFirst
        While Not vRecordset.EOF
        Me.CMBStore.AddItem Trim(vRecordset.Fields("shelfcode").Value)
        vRecordset.MoveNext
        Wend
End If
vRecordset.Close
Me.CMBStore.Text = "AVL"
End Sub

Public Sub GetShelf(vWHCode As String)
Dim vRecordset As New ADODB.Recordset
Dim vQuery As String

'CMBShelf.Clear
'vQuery = "exec dbo.USP_MB_SearchShelfID '" & vWHCode & "',''  "
'If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
 '       vRecordset.MoveFirst
  '      While Not vRecordset.EOF
   '     Me.CMBShelf.AddItem Trim(vRecordset.Fields("shelfid").Value)
    '    vRecordset.MoveNext
     '   Wend'
'End If
'vRecordset.Close
End Sub

Private Sub Form_Unload(Cancel As Integer)
   Call Me.vClearScreen
   vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
   gConnection.Execute vQuery
      
End Sub

Private Sub ListViewCountID_DblClick()
Dim vIndex As Integer

On Error Resume Next

If Me.ListViewCountID.ListItems.Count > 0 Then
   vIndex = Me.ListViewCountID.SelectedItem.Index
   MEBCountID.Text = Me.ListViewCountID.ListItems(vIndex).SubItems(1)
   TextCountDescription.Text = Me.ListViewCountID.ListItems(vIndex).SubItems(2)
   Me.DTPDate1.Value = Me.ListViewCountID.ListItems(vIndex).SubItems(3)
   Me.DTPDate2.Value = Me.ListViewCountID.ListItems(vIndex).SubItems(4)
   Me.PICCount.Visible = False
End If

End Sub

Private Sub ListViewItemList_DblClick()
Dim vIndex As Integer

On Error Resume Next

If Me.ListViewItemList.ListItems.Count > 0 Then
   vIndex = Me.ListViewItemList.SelectedItem.Index
   vMemIndexDup = vIndex
   Me.TextShelf.Text = Me.ListViewItemList.ListItems(vIndex).SubItems(10)
   Me.TextScanBarcode.Text = Me.ListViewItemList.ListItems(vIndex).SubItems(1)
   If Me.ListViewItemList.ListItems(vIndex).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vIndex).SubItems(4) = "" And Me.ListViewItemList.ListItems(vIndex).SubItems(5) = "" Then
      Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(vIndex).SubItems(3), "####0.00")
   ElseIf Me.ListViewItemList.ListItems(vIndex).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vIndex).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vIndex).SubItems(5) = "" Then
      Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(vIndex).SubItems(4), "####0.00")
   ElseIf Me.ListViewItemList.ListItems(vIndex).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vIndex).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vIndex).SubItems(5) <> "" Then
      Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(vIndex).SubItems(5), "####0.00")
   End If
   Me.TextQty.SetFocus
End If
End Sub

Private Sub ListViewItemList_KeyDown(KeyCode As Integer, Shift As Integer)
Dim vIndex As Integer
Dim i As Integer

On Error Resume Next

If Me.ListViewItemList.ListItems.Count > 0 Then
   If KeyCode = 46 Then
      If vGetIsCancel = 0 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         vIndex = Me.ListViewItemList.SelectedItem.Index
         Me.ListViewItemList.ListItems.Remove (vIndex)
         
         For i = 1 To Me.ListViewItemList.ListItems.Count
            Me.ListViewItemList.ListItems(i).Text = i
         Next i
      End If
   End If
   
   On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
    Me.MEBCountID1.SelText = Left(vCountID, 4)
    Call MEBCountID1_LostFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
    Me.CMBWHCode.Text = Left(vWHCode, 3)
    Call CMBWHCode_Click
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
    Me.CMBStore.Text = Left(vStoreCode, 3)
    Call CMBStore_Click
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
    Me.TextRow.Text = vRowCode
    Call TextRow_LostFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
    Me.TextShelf.Text = vShelfCode
    Call TextShelf_LostFocus
   End If
End If

End If
End Sub

Private Sub ListViewItemList_OLEDragOver(Data As MSComctlLib.DataObject, Effect As Long, Button As Integer, Shift As Integer, x As Single, y As Single, State As Integer)
On Error Resume Next

Set ListViewItemList.DropHighlight = ListViewItemList.HitTest(x, y)
End Sub

Private Sub ListViewShowItemExist_KeyDown(KeyCode As Integer, Shift As Integer)
Dim vRecordset As New ADODB.Recordset
Dim vWHCode As String
Dim vListItem As ListItem
Dim vItemCode As String
Dim vStore As String
Dim vCheckInShelf As Integer
Dim vShelfCode As String
Dim vAnswer As Integer

On Error Resume Next

If KeyCode = 27 Then
   Me.PICShowItemExist.Visible = False
   
   vItemCode = Trim(UCase(TextScanBarcode.Text))
   vWHCode = Me.CMBWHCode.Text
   vShelfCode = Me.TextShelf.Text
   
   If vCheckCountExist = 1 And vIsOtherRow = 1 Then
      MsgBox "สินค้ารหัส " & vItemCode & " มีการบันทึกข้อมูลการตรวจนับไปแล้วไม่สามารถบันทึกหลาย Row ได้", vbCritical, "Send Error Message"
      Me.TextScanBarcode.Text = ""
      vCheckCountExist = 0
      Me.TextScanBarcode.SetFocus
      Exit Sub
   End If

      
   vQuery = "exec dbo.USP_MB_SearchItemCodeRecProduct '" & vWHCode & "','" & vShelfCode & "','" & vItemCode & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      vCheckInShelf = 1
   Else
      vCheckInShelf = 0
   End If
   vRecordset.Close
   
   If vCheckInShelf = 0 Then
      vAnswer = MsgBox("สินค้ารหัส " & vItemCode & " ไม่มีอยู่ในทะเบียนการยิงที่เก็บ จะเพิ่มรายการสินค้านี้หรือไม่ ", vbYesNo, "")
      If vAnswer = 7 Then
         Me.TextScanBarcode.Text = ""
         Me.TextScanBarcode.SetFocus
      Exit Sub
      End If
      
            Dim j As Integer
            Dim vDuplicateItem As String
            Dim vDuplicateShelf As String
            
            For j = 1 To Me.ListViewItemList.ListItems.Count
            
            vDuplicateItem = Me.ListViewItemList.ListItems(j).SubItems(1)
            vDuplicateShelf = Me.ListViewItemList.ListItems(j).SubItems(10)
            
            If vItemCode = vDuplicateItem Then
               If vShelfCode = vDuplicateShelf Then
                  MsgBox "มีการบันทึกสินค้าซ้ำกับรายการที่ " & j & " รหัส " & vItemCode & " โปรแกรมจะดึงข้อมูลการตรวจนับครั้งก่อนขึ้นมาให้", vbCritical, "Send Information"
                  vMemIndexDup = j
                  If Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) = "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Me.ListViewItemList.ListItems(j).SubItems(3)
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Me.ListViewItemList.ListItems(j).SubItems(4)
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) <> "" Then
                     Me.TextQty.Text = Me.ListViewItemList.ListItems(j).SubItems(5)
                  End If
               Else
               End If
            End If
            
            Next j
            
      Me.TextQty.SetFocus
   Else
            For j = 1 To Me.ListViewItemList.ListItems.Count
            
            vDuplicateItem = Me.ListViewItemList.ListItems(j).SubItems(1)
            vDuplicateShelf = Me.ListViewItemList.ListItems(j).SubItems(10)
            
            If vItemCode = vDuplicateItem Then
               If vShelfCode = vDuplicateShelf Then
                  MsgBox "มีการบันทึกสินค้าซ้ำกับรายการที่ " & j & " รหัส " & vItemCode & " โปรแกรมจะดึงข้อมูลการตรวจนับครั้งก่อนขึ้นมาให้", vbCritical, "Send Information"
                  vMemIndexDup = j
                  If Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) = "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(3), "####0.00")
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(4), "####0.00")
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) <> "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(5), "####0.00")
                  End If
               Else
               End If
            End If
            
            Next j
            
      Me.TextQty.SetFocus
   End If
End If
End Sub

Private Sub MEBCountID1_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub MEBCountID1_KeyPress(KeyAscii As Integer)
Dim vRecordset As New ADODB.Recordset
Dim vCountID As String
Dim vCheckCountID As Integer

On Error Resume Next

If KeyAscii = 13 Then
   If Me.MEBCountID1.Text <> "__/__" Then
      vCountID = Me.MEBCountID1.Text
      vQuery = "select count(countid) as vCount from npmaster.dbo.TB_MB_CountItemQTYMaster where countid = '" & vCountID & "' "
      If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
         vCheckCountID = vRecordset.Fields("vcount").Value
      End If
      vRecordset.Close
      
      If vCheckCountID = 0 Then
         MsgBox "ไม่มี รอบของการนับสต๊อกนี้อยู่ในระบบ", vbCritical, "Send Error Message "
         Me.MEBCountID1.Text = "__/__"
         Me.MEBCountID1.SetFocus
      Else
         vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0"
         gConnection.Execute vQuery
         Call vGetCheckOpenDoc
         Me.DTPDocDate.SetFocus
      End If
   End If
End If
End Sub

Private Sub MEBCountID1_LostFocus()
Dim vRecordset As New ADODB.Recordset
Dim vCountID As String
Dim vCheckCountID As Integer

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" Then
   vCountID = Me.MEBCountID1.Text
   vQuery = "select count(countid) as vCount from npmaster.dbo.TB_MB_CountItemQTYMaster where countid = '" & vCountID & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      vCheckCountID = vRecordset.Fields("vcount").Value
   End If
   vRecordset.Close
   
   If vCheckCountID = 0 Then
      MsgBox "ไม่มี รอบของการนับสต๊อกนี้อยู่ในระบบ", vbCritical, "Send Error Message "
      Me.MEBCountID1.Text = "__/__"
      Me.MEBCountID1.SetFocus
   End If
End If
End Sub

Private Sub MEBPercentDiff_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub MEBPercentDiff_LostFocus()
Me.TextRow.SetFocus
End Sub

Private Sub OPT001_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub OPT002_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub Picture1_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub Picture2_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub Picture3_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub TextQTY_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub TextQty_KeyPress(KeyAscii As Integer)
Dim vRecordset As New ADODB.Recordset
Dim i As Integer
Dim vWHCode As String
Dim vListItem As ListItem
Dim vItemCode As String
Dim vStore As String
Dim vStockQTY As Double
Dim vCheckQty As Double
Dim vCountDot As Integer
Dim vCount As Double

Dim vBasketItemCode As String
Dim vBasketQTY As Double
Dim vBasketUnitCode As String
Dim vBasketItemName As String
      
On Error Resume Next

If KeyAscii = 13 Then

'If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
  ' MsgBox "ไม่สามารถบันทึกผลการตรวจนับย้อนหลังได้ ", vbCritical, "Send Error Message"
 '  Me.TextQty.Text = ""
  ' Me.TextScanBarcode.Text = ""
   'Me.DTPDocDate.SetFocus
   
   'Exit Sub
'End If

   If Me.TextQty.Text <> "" Then
      If Len(Format(Me.TextQty.Text, "####0")) > 6 Then
         MsgBox "กรอกข้อมูล จำนวนที่นับได้ให้ถูกต้อง เพราะกรอกได้", vbCritical, "Send Error Message"
         Me.TextQty.SetFocus
         Exit Sub
      End If
   
      Call CheckNumber(Trim(Me.TextQty.Text))
      If vCheckValueNumber = False Then
         MsgBox "กรอกข้อมูลได้เฉพาะอักขระที่เกี่ยวข้องกับตัวเลขเท่านั้น", vbCritical, "Send Error Message"
         Me.TextQty.SetFocus
         Exit Sub
      Else
         vCountDot = CheckDot(Me.TextQty.Text)
         If vCountDot <= 1 Then
            If Me.TextQty.Text <> "." Then
               vCheckQty = Me.TextQty.Text
               Me.TextQty.Text = Format(vCheckQty, "####0.00")
            Else
               MsgBox "กรอกอักขระผิด กรุณาแก้ไข", vbCritical, "Send Error Message"
               Me.TextQty.SetFocus
               Exit Sub
            End If
         Else
            MsgBox "กรอกอักขระผิด กรุณาแก้ไข", vbCritical, "Send Error Message"
            Me.TextQty.SetFocus
            Exit Sub
         End If
      End If

   
      vMemCheckKeyQTY = 1
      
      vItemCode = Trim(TextScanBarcode.Text)
      vWHCode = Me.CMBWHCode.Text
      vStore = Me.CMBStore.Text
       i = Me.ListViewItemList.ListItems.Count
       
       If vMemIndexDup = 0 Then
       vQuery = "exec dbo.USP_ISP_SearchProduct3 '" & vItemCode & "','" & vWHCode & "','" & vStore & "' "
       If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
          vRecordset.MoveFirst
             i = i + 1
             While Not vRecordset.EOF
             Set vListItem = Me.ListViewItemList.ListItems.Add(, , i)
             
             If Me.TextQty.Text <> "" Then
             vCount = Me.TextQty.Text
             Else
             vCount = 0
             End If
             
             vListItem.SubItems(1) = vRecordset.Fields("itemcode").Value
             vListItem.SubItems(2) = vRecordset.Fields("itemname").Value
             vListItem.SubItems(3) = Format(vCount, "##,##0.00")
             vListItem.SubItems(6) = vRecordset.Fields("defStkUnitCode").Value
             If IsNull(vRecordset.Fields("qty").Value) And Me.DTPDocDate.Day = Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             vStockQTY = 0
             ElseIf IsNull(vRecordset.Fields("qty").Value) And Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             vStockQTY = -1
             ElseIf Not IsNull(vRecordset.Fields("qty").Value) And Me.DTPDocDate.Day = Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             vStockQTY = vRecordset.Fields("qty").Value
             ElseIf Not IsNull(vRecordset.Fields("qty").Value) And Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             vStockQTY = -1
             End If
             
             If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             vListItem.SubItems(7) = Format(-1, "##,##0.00")
             Else
             vListItem.SubItems(7) = Format(vStockQTY, "##,##0.00")
             End If
             
             vListItem.SubItems(8) = Format(vStockQTY - vCount, "##,##0.00")
             If vStockQTY <> 0 Then
                vListItem.SubItems(9) = Format((100 - (vCount * 100) / vStockQTY), "##,##0.00")
             Else
               vListItem.SubItems(9) = Format(100, "##,##0.00")
             End If
             vListItem.SubItems(10) = Me.TextShelf.Text
             vListItem.SubItems(11) = ""
          
          
             If Me.TextQty.Text <> "" Then
             vCount = Me.TextQty.Text
             Else
             vCount = 0
             End If
             If IsNull(vRecordset.Fields("qty").Value) Then
             vStockQTY = 0
             Else
             vStockQTY = vRecordset.Fields("qty").Value
             End If
          vRecordset.MoveNext
          Wend
      Else
         MsgBox "ไม่มีรหัสสินค้า " & vItemCode & " นี้ในระบบ ", vbCritical, "Send Error"
         Exit Sub
      End If
      vRecordset.Close
           
      vBasketItemCode = Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(1)
      vBasketItemName = Left(Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(2), 50)
      If Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(5) <> "" Then
         vBasketQTY = Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(5)
      ElseIf Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(4) <> "" And Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(5) = "" Then
         vBasketQTY = Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(4)
      ElseIf Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(3) <> "" And Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(4) = "" And Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(5) = "" Then
         vBasketQTY = Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(3)
      End If
      vBasketUnitCode = Me.ListViewItemList.ListItems(Me.ListViewItemList.ListItems.Count).SubItems(6)
      
      Me.LBLShowDetailsAddItem.Caption = "รายการล่าสุดที่คีย์คือ  " & vBasketItemCode & "/" & vBasketItemName & "   " & " จำนวน  " & vBasketQTY & "  " & vBasketUnitCode

      Else

       If Me.TextQty.Text <> "" Then
       vCount = Me.TextQty.Text
       Else
       vCount = 0
       End If
             
       vQuery = "exec dbo.USP_ISP_SearchProduct3 '" & vItemCode & "','" & vWHCode & "','" & vStore & "' "
       If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
          vRecordset.MoveFirst
          While Not vRecordset.EOF
          If IsNull(vRecordset.Fields("qty").Value) And vMemIndexDup = 0 Then
             vStockQTY = 0
          ElseIf IsNull(vRecordset.Fields("qty").Value) And vMemIndexDup <> 0 Then
             vStockQTY = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(7)
          ElseIf Not IsNull(vRecordset.Fields("qty").Value) And vMemIndexDup = 0 Then
             vStockQTY = vRecordset.Fields("qty").Value
         ElseIf Not IsNull(vRecordset.Fields("qty").Value) And vMemIndexDup <> 0 Then
            vStockQTY = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(7)
          End If
                             
          'If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
           '  If Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = "" Then
            '    Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = Format(vCount, "##,##0.00")
             'ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
              '  Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             'ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) <> "" Then
              '  Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             'End If
          'End
          
          If OPT001.Value = True And Me.DTPDocDate.Day = Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             If Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) <> "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             End If
          
          ElseIf OPT001.Value = True And Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             If Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) <> "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             End If
          
          ElseIf OPT002.Value = True And Me.DTPDocDate.Day = Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             If Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) <> "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             End If
             
          ElseIf OPT002.Value = True And Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) Then
             If Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) <> "" Then
                Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = Format(vCount, "##,##0.00")
             End If
          End If
                  
          Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(7) = Format(vStockQTY, "##,##0.00")
          Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(8) = Format(vStockQTY - vCount, "##,##0.00")
          If vStockQTY <> 0 Then
             Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(9) = Format((100 - (vCount * 100) / vStockQTY), "##,##0.00")
          Else
            Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(9) = Format(100, "##,##0.00")
          End If
             
          vRecordset.MoveNext
          Wend
      End If
      vRecordset.Close
      
      vBasketItemCode = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(1)
      vBasketItemName = Left(Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(2), 50)
      If Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) <> "" Then
         vBasketQTY = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5)
      ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
         vBasketQTY = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4)
      ElseIf Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3) <> "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(4) = "" And Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(5) = "" Then
         vBasketQTY = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(3)
      End If
      vBasketUnitCode = Me.ListViewItemList.ListItems(vMemIndexDup).SubItems(6)
      
      Me.LBLShowDetailsAddItem.Caption = "รายการล่าสุดที่คีย์คือ  " & vBasketItemCode & "/" & vBasketItemName & "  " & " จำนวน  " & vBasketQTY & "  " & vBasketUnitCode


      End If
      
      vMemIndexDup = 0
      Me.TextScanBarcode.Text = ""
      Me.TextQty.Text = Format(0, "##,##0.00")
      vMemCheckScanKey = 0
      Me.TextScanBarcode.SetFocus
   End If
End If
End Sub

Private Sub TextRow_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If

'f1 = 112
'f2 = 113
'f3 = 114
'f4 = 115
'f5= 116
'f6 = 117
'f7 = 118
'f8 = 119
'f9 = 120
'f10 = 121
'f11= 122
'f12= 123

End Sub

Private Sub TextRow_KeyPress(KeyAscii As Integer)
Dim vRecordset As New ADODB.Recordset
Dim vCountRow As Integer
Dim vWHCode As String
Dim vStoreCode As String
Dim vRow As String

On Error Resume Next

If KeyAscii = 13 And Me.CMBWHCode.Text <> "" And Me.TextRow.Text <> "" Then
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRow = Me.TextRow.Text
   
   vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',0 "
   gConnection.Execute vQuery

   vQuery = "exec dbo.USP_MB_SearchRow '" & vWHCode & "','" & vStoreCode & "','" & vRow & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      vCountRow = 1
   Else
      vCountRow = 0
   End If
  vRecordset.Close
  
  If vCountRow = 0 Then
     MsgBox "คลัง " & vWHCode & " ไม่มีทะเบียน Row  " & vRow & " กรุณาตรวจสอบ", vbInformation, "Send Error Message"
     Me.TextRow.Text = ""
     Me.IMGNew.Visible = True
     Me.IMGCancel.Visible = False
     Me.IMGConfirm.Visible = False
     
     vGetIsConfirm = 0
     vGetIsFinish = 0
     vGetIsCancel = 0
     vGetIsRecQTY = 0
     vIsOpen = 0

     Me.TextRow.SetFocus
  Else
     Me.TextRow.Text = UCase(Me.TextRow.Text)
     Me.TextShelf.SetFocus
  End If
End If
End Sub

Public Sub vGetCheckOpenDoc()
Dim vRecordset As New ADODB.Recordset
Dim vDocNo As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim vUsedDateTime As String
Dim vUsedUser As String
Dim vDocDate As String

On Error Resume Next

If Me.MEBCountID1.Text <> "" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then

   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   vRemDocDate = vDocDate
   
   vDocNo = vCountID & "_" & vWHCode & "_" & vStoreCode & vRowID
   vRemStockDocNo = vDocNo
   vRemCountID = vCountID
   vRemWHCode = vWHCode
   vRemStoreCode = vStoreCode
   vRemRowID = vRowID
      
   vQuery = "exec dbo.USP_MB_CheckUpdateUsedDoc '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      vRemStockOpen = vRecordset.Fields("isusedocno").Value
      If IsNull(vRecordset.Fields("UsedUser").Value) Then
         vUsedUser = ""
      Else
         vUsedUser = vRecordset.Fields("UsedUser").Value
      End If
      If IsNull(vRecordset.Fields("UsedDateTime").Value) Then
         vUsedDateTime = ""
      Else
        vUsedDateTime = vRecordset.Fields("UsedDateTime").Value
      End If
   Else
      Me.ListViewItemList.ListItems.Clear
      Me.TextShelf.Text = ""
      vRemStockOpen = 0
   End If
   vRecordset.Close
   
   If vRemStockOpen = 0 Or (vRemStockOpen = 1 And vUsedUser = vUserID) Then
      Me.CMDSave.Enabled = True
      vQuery = "exec dbo.USP_MB_UpdateUsedStockNo '" & vRemDocDate & "','" & vRemStockDocNo & "','" & vRemCountID & "','" & vRemWHCode & "','" & vRemStoreCode & "','" & vRemRowID & "','" & vUserID & "',1 "
      gConnection.Execute vQuery
      Call vGetDataCountStock
   ElseIf vRemStockOpen = 1 And vUsedUser <> vUserID Then
      MsgBox "เอกสารบันทึกผลการตรวจนับเลขที่ " & vDocNo & " นี้ได้ถูกเปิดใช้งานบันทึกข้อมูล โดย " & vUsedUser & " ไปแล้ว เมื่อวันที่เวลา : " & vUsedDateTime & " จึงไม่สามารถเปิดขึ้นมาแก้ไขข้อมูลได้ ", vbCritical, "Send Error Message"
      Me.ListViewItemList.ListItems.Clear
      Me.TextRow.Text = ""
      Me.TextShelf.Text = ""
      Me.TextRow.SetFocus
   End If
Else
   Me.ListViewItemList.ListItems.Clear
End If
End Sub
Public Sub DisableButton()
On Error Resume Next

Me.CMDSave.Enabled = False
Me.CMDCloseProcess.Enabled = False
Me.CMDProcess.Enabled = False
Me.CMDTransfer.Enabled = False
Me.CMDCloseCountStock.Enabled = False
End Sub

Public Sub EnableButton()
On Error Resume Next

Me.CMDSave.Enabled = True
Me.CMDCloseProcess.Enabled = True
Me.CMDProcess.Enabled = True
Me.CMDTransfer.Enabled = True
Me.CMDCloseCountStock.Enabled = True
End Sub

Public Sub vGetDataCountStock()
Dim vRecordset As New ADODB.Recordset
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim i As Integer
Dim vCountStock As Double
Dim vOnHand As Double
Dim vListItem As ListItem

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then
   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   
   vQuery = "exec dbo.USP_MB_SearchCountItemDetails '" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      Me.ListViewItemList.ListItems.Clear
      
      vGetIsConfirm = vRecordset.Fields("isconfirm").Value
      vGetIsFinish = vRecordset.Fields("isfinish").Value
      vGetIsCancel = vRecordset.Fields("iscancel").Value
      vGetIsRecQTY = vRecordset.Fields("isrecqty").Value
      
      If vGetIsCancel = 0 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         Me.IMGNew.Visible = True
         Me.IMGCancel.Visible = False
         Me.IMGConfirm.Visible = False
      ElseIf vGetIsCancel = 1 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         Me.IMGNew.Visible = False
         Me.IMGCancel.Visible = True
         Me.IMGConfirm.Visible = False
         Me.CMDCancel.Enabled = False
      ElseIf vGetIsCancel = 0 And vGetIsConfirm = 1 And vGetIsFinish = 0 Then
         Me.IMGNew.Visible = False
         Me.IMGCancel.Visible = False
         Me.IMGConfirm.Visible = True
         Me.CMDCancel.Enabled = True
      ElseIf vGetIsCancel = 0 And vGetIsConfirm = 1 And vGetIsFinish = 1 Then
         Me.IMGNew.Visible = False
         Me.IMGCancel.Visible = False
         Me.IMGConfirm.Visible = True
         Me.CMDCancel.Enabled = True
      End If
      
      If vRecordset.Fields("percentdiff").Value <> 0 Then
      Me.MEBPercentDiff.Mask = Format(vRecordset.Fields("percentdiff").Value, "##,##0.00")
      Else
      Me.MEBPercentDiff.SelText = "__"
      End If
      vRecordset.MoveFirst
      i = 1
      While Not vRecordset.EOF
      Set vListItem = Me.ListViewItemList.ListItems.Add(, , i)
      vListItem.SubItems(1) = vRecordset.Fields("itemcode").Value
      vListItem.SubItems(2) = vRecordset.Fields("itemname").Value
      If vRecordset.Fields("count1").Value <> -1 Then
         vListItem.SubItems(3) = Format(vRecordset.Fields("count1").Value, "##,##0.00")
      Else
         vListItem.SubItems(3) = ""
      End If
      If vRecordset.Fields("count2").Value <> -1 Then
         vListItem.SubItems(4) = Format(vRecordset.Fields("count2").Value, "##,##0.00")
      Else
         vListItem.SubItems(4) = ""
      End If
      If vRecordset.Fields("count3").Value <> -1 Then
         vListItem.SubItems(5) = Format(vRecordset.Fields("count3").Value, "##,##0.00")
      Else
         vListItem.SubItems(5) = ""
      End If
      If IsNull(vRecordset.Fields("countqty").Value) Then
         vCountStock = 0
      Else
         vCountStock = vRecordset.Fields("countqty").Value
      End If
      
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vOnHand = 0
      Else
         vOnHand = vRecordset.Fields("onhand").Value
      End If
      
      vListItem.SubItems(6) = vRecordset.Fields("unitcode").Value
      vListItem.SubItems(7) = Format(vOnHand, "##,##0.00")
      vListItem.SubItems(8) = Format(vCountStock - vOnHand, "##,##0.00")
      If vCountStock <> 0 Then
         If vOnHand <> 0 Then
            vListItem.SubItems(9) = Format((100 - (vCountStock * 100) / vOnHand), "##,##0.00")
         Else
            vListItem.SubItems(9) = Format(100, "##,##0.00")
         End If
      Else
        vListItem.SubItems(9) = Format(100, "##,##0.00")
      End If
      vListItem.SubItems(10) = vRecordset.Fields("shelfcode").Value
      
      Me.ListViewItemList.ListItems(i).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(1).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(2).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(3).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(4).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(5).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(6).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(7).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(8).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(9).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(10).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(11).ForeColor = "&H00000040"
      vRecordset.MoveNext
      i = i + 1
      Wend
      
      If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) And Me.ListViewItemList.ListItems.Count > 0 Then
         Me.OPT001.Value = False
         Me.OPT002.Value = True
      Else
         Me.OPT001.Value = True
         Me.OPT002.Value = False
      End If
      
      If vGetIsCancel = 1 Then
         Call DisableButton
      ElseIf vGetIsConfirm = 1 And vGetIsRecQTY = 0 Then
         Me.CMDSave.Enabled = False
         Me.CMDCloseProcess.Enabled = False
         Me.CMDProcess.Enabled = False
         Me.CMDTransfer.Enabled = False
         Me.CMDCloseCountStock.Enabled = False
         Me.CMDConfirmQTY.Enabled = True
      ElseIf vGetIsRecQTY = 1 Then
         Me.CMDSave.Enabled = False
         Me.CMDCloseProcess.Enabled = False
         Me.CMDProcess.Enabled = False
         Me.CMDTransfer.Enabled = True
         Me.CMDCloseCountStock.Enabled = False
         Me.CMDConfirmQTY.Enabled = True
      ElseIf vGetIsFinish = 1 Then
         Call DisableButton
      Else
         Call EnableButton
      End If
      vIsOpen = 1
   Else
      Me.ListViewItemList.ListItems.Clear
      vIsOpen = 0
      vGetIsCancel = 0
      vGetIsConfirm = 0
      vGetIsFinish = 0
      Me.IMGNew.Visible = True
      Me.IMGCancel.Visible = False
      Me.IMGConfirm.Visible = False
      Me.LBLShowDetailsAddItem.Caption = ""
         
      Call EnableButton
   End If
   vRecordset.Close
   
      If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) And Me.ListViewItemList.ListItems.Count > 0 Then
         Me.OPT001.Value = False
         Me.OPT002.Value = True
      Else
         Me.OPT001.Value = True
         Me.OPT002.Value = False
      End If
      
End If
End Sub

Private Sub TextQty_LostFocus()
Dim vCheckQty As Double
Dim vCountDot As Integer

On Error Resume Next

If Me.TextQty.Text <> "" Then
   Call CheckNumber(Trim(Me.TextQty.Text))
   If vCheckValueNumber = False Then
      MsgBox "กรอกข้อมูลได้เฉพาะอักขระที่เกี่ยวข้องกับตัวเลขเท่านั้น", vbCritical, "Send Error Message"
      Me.TextQty.SetFocus
   Else
      vCountDot = CheckDot(Me.TextQty.Text)
      If vCountDot <= 1 Then
         If Me.TextQty.Text <> "." Then
            vCheckQty = Me.TextQty.Text
            Me.TextQty.Text = Format(vCheckQty, "####0.00")
         Else
            MsgBox "กรอกอักขระผิด กรุณาแก้ไข", vbCritical, "Send Error Message"
            Me.TextQty.SetFocus
         End If
      Else
         MsgBox "กรอกอักขระผิด กรุณาแก้ไข", vbCritical, "Send Error Message"
         Me.TextQty.SetFocus
      End If
   End If

If vMemCheckKeyQTY <> 1 Then
   Call TextQty_KeyPress(13)
   vMemCheckKeyQTY = 0
End If

End If
End Sub

Private Sub TextRow_LostFocus()
Call TextRow_KeyPress(13)
Call vGetCheckOpenDoc
End Sub

Private Sub TextScanBarcode_Change()
Me.TextQty.Text = ""
End Sub

Private Sub TextScanBarcode_GotFocus()
vMemCheckKeyQTY = 0
End Sub

Private Sub TextScanBarcode_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub TextScanBarcode_KeyPress(KeyAscii As Integer)
Dim vRecordset As New ADODB.Recordset
Dim i As Integer
Dim vCheckItem As String
Dim vWHCode As String
Dim vListItem As ListItem
Dim vItemCode As String
Dim vStore As String
Dim vCheckInShelf As Integer
Dim vShelfCode As String
Dim vAnswer As Integer
Dim vCountID As String
Dim vGetDocNo As String
Dim vGetDocDate As String
Dim n As Integer
Dim vListItemExist As ListItem
Dim vDocDate As Date
Dim vRowID As String

Dim vCheckExistCountID As String
Dim vCheckExistDocDate As String
Dim vCheckExistWHCode As String
Dim vCheckExistRowID As String
Dim vCheckExistStore As String

On Error Resume Next

If KeyAscii = 13 Then

   If Me.TextScanBarcode.Text <> "" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextShelf.Text <> "" And Me.MEBCountID1.Text <> "" Then
      vCountID = Me.MEBCountID1.Text
      vItemCode = Trim(UCase(TextScanBarcode.Text))
      vWHCode = Me.CMBWHCode.Text
      vStore = Me.CMBStore.Text
      vShelfCode = Me.TextShelf.Text
      vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
      vRowID = Me.TextRow.Text
      
      vMemCheckScanKey = 1
      vMemCheckKeyQTY = 0
      
      vQuery = "exec dbo.USP_MB_CheckItemMultiLocate '" & vCountID & "','" & vWHCode & "','" & vStore & "','" & vItemCode & "' "
      If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
         Me.PICShowItemExist.Visible = True
         Me.ListViewShowItemExist.ListItems.Clear
         vRecordset.MoveFirst
         While Not vRecordset.EOF
         n = n + 1
         vCheckExistCountID = vRecordset.Fields("countid").Value
         vCheckExistDocDate = vRecordset.Fields("docdate").Value
         vCheckExistWHCode = vRecordset.Fields("whcode").Value
         vCheckExistRowID = vRecordset.Fields("rowid").Value
         vCheckExistStore = vRecordset.Fields("storecode").Value
         
         Set vListItemExist = Me.ListViewShowItemExist.ListItems.Add(, , n)
         vListItemExist.SubItems(1) = vRecordset.Fields("docno").Value
         vListItemExist.SubItems(2) = vRecordset.Fields("docdate").Value
         vListItemExist.SubItems(3) = vRecordset.Fields("rowid").Value
         vListItemExist.SubItems(4) = vRecordset.Fields("shelfcode").Value
         vListItemExist.SubItems(5) = Format(vRecordset.Fields("countqty").Value, "##,##0.00")
         vListItemExist.SubItems(6) = Format(vRecordset.Fields("qty").Value, "##,##0.00")
         vListItemExist.SubItems(7) = vRecordset.Fields("unitcode").Value
         vRecordset.MoveNext
         Wend
         
         If vCheckExistCountID = vCountID And vCheckExistDocDate = vDocDate And vCheckExistWHCode = vWHCode And vCheckExistRowID = vRowID And vCheckExistStore = vStore Then
            vIsOtherRow = 0
         Else
            vIsOtherRow = 1
         End If
         vCheckCountExist = 1
         
         Me.ListViewShowItemExist.SetFocus
      Else
         vCheckCountExist = 0
      End If
       vRecordset.Close
       
      If vCheckCountExist = 0 Then
         vQuery = "exec dbo.USP_MB_SearchItemCodeRecProduct '" & vWHCode & "','" & vShelfCode & "','" & vItemCode & "' "
         If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
            vCheckInShelf = 1
         Else
            vCheckInShelf = 0
         End If
         vRecordset.Close
          
         If vCheckInShelf = 0 Then
            vAnswer = MsgBox("สินค้ารหัส " & vItemCode & " ไม่มีอยู่ในทะเบียนการยิงที่เก็บ จะเพิ่มรายการสินค้านี้หรือไม่ ", vbYesNo, "")
            If vAnswer = 7 Then
               Me.TextScanBarcode.Text = ""
               Exit Sub
            End If
            
            
            Dim j As Integer
            Dim vDuplicateItem As String
            Dim vDuplicateShelf As String
            
            For j = 1 To Me.ListViewItemList.ListItems.Count
            
            vDuplicateItem = Me.ListViewItemList.ListItems(j).SubItems(1)
            vDuplicateShelf = Me.ListViewItemList.ListItems(j).SubItems(10)
            
            If vItemCode = vDuplicateItem Then
               If vShelfCode = vDuplicateShelf Then
                  MsgBox "มีการบันทึกสินค้าซ้ำกับรายการที่ " & j & " รหัส " & vItemCode & " โปรแกรมจะดึงข้อมูลการตรวจนับครั้งก่อนขึ้นมาให้", vbCritical, "Send Information"
                   vMemIndexDup = j
                  If Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) = "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(3), "####0.00")
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(4), "####0.00")
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) <> "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(5), "####0.00")
                  End If
               End If
            End If
            
            Next j
                                    
            Me.TextQty.SetFocus
         Else
         
            For j = 1 To Me.ListViewItemList.ListItems.Count
            
            vDuplicateItem = Me.ListViewItemList.ListItems(j).SubItems(1)
            vDuplicateShelf = Me.ListViewItemList.ListItems(j).SubItems(10)
            
            If vItemCode = vDuplicateItem Then
               If vShelfCode = vDuplicateShelf Then
                  MsgBox "มีการบันทึกสินค้าซ้ำกับรายการที่ " & j & " รหัส " & vItemCode & " โปรแกรมจะดึงข้อมูลการตรวจนับครั้งก่อนขึ้นมาให้", vbCritical, "Send Information"
                   vMemIndexDup = j
                  If Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) = "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(3), "####0.00")
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) = "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(4), "####0.00")
                  ElseIf Me.ListViewItemList.ListItems(j).SubItems(3) <> "" And Me.ListViewItemList.ListItems(j).SubItems(4) <> "" And Me.ListViewItemList.ListItems(j).SubItems(5) <> "" Then
                     Me.TextQty.Text = Format(Me.ListViewItemList.ListItems(j).SubItems(5), "####0.00")
                  End If
               End If
            End If
            
            Next j
         End If
         
         Me.TextQty.SetFocus
      End If
   
   Else
      MsgBox "กรุณาระบุคลังและที่เก็บให้เรียบร้อยก่อน กรอกรายการสินค้า", vbCritical, "Send Error Message"
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub TextScanBarcode_LostFocus()
If Me.TextScanBarcode.Text <> "" Then
   vMemCheckKeyQTY = 0
   If vMemCheckScanKey <> 1 Then
      Call TextScanBarcode_KeyPress(13)
      vMemCheckScanKey = 0
   End If
End If
End Sub

Private Sub TextSearchCount_KeyPress(KeyAscii As Integer)
Dim vRecordset As New ADODB.Recordset
Dim vSearch As String
Dim vListCount As ListItem
Dim i As Integer

On Error Resume Next

If KeyAscii = 13 Then
   If Me.TextSearchCount.Text <> "" Then
      Me.ListViewCountID.ListItems.Clear
      vQuery = "exec dbo.USP_MB_SearchCountItemQTYMaster '' "
      If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
         vRecordset.MoveFirst
         i = 1
         While Not vRecordset.EOF
         Set vListCount = Me.ListViewCountID.ListItems.Add(, , i)
         vListCount.SubItems(1) = vRecordset.Fields("countid").Value
         vListCount.SubItems(2) = vRecordset.Fields("description").Value
         vRecordset.MoveNext
         Wend
         Me.ListViewCountID.SetFocus
      End If
      vRecordset.Close
   End If
End If
End Sub

Private Sub TextShelf_KeyDown(KeyCode As Integer, Shift As Integer)
On Error Resume Next

If KeyCode = 112 Then
   Me.PICHelp.Visible = True
   Me.CMDClosePICHelp.SetFocus
End If
If KeyCode = 113 Then
Dim vCountID As String

   vCountID = InputBox("รอบของการนับ :", "กรอกข้อมูล รอบของการนับ")
   If vCountID <> "" Then
       Me.MEBCountID1.SelText = Left(vCountID, 4)
       Call MEBCountID1_LostFocus
       Me.DTPDocDate.SetFocus
   Else
      Me.MEBCountID1.SetFocus
   End If
End If

If KeyCode = 114 Then
Dim vWHCode As String

   vWHCode = InputBox("คลัง :", "กรอกข้อมูล คลังที่นับสต๊อก")
   If vWHCode <> "" Then
      Me.CMBWHCode.Text = Left(vWHCode, 3)
      Call CMBWHCode_Click
      Me.CMBStore.SetFocus
   Else
      Me.CMBWHCode.SetFocus
   End If
End If

If KeyCode = 115 Then
Dim vStoreCode As String

   vStoreCode = InputBox("สโตร์ :", "กรอกข้อมูล สโตร์ที่นับสต๊อก")
   If vStoreCode <> "" Then
       Me.CMBStore.Text = Left(vStoreCode, 3)
       Call CMBStore_Click
       Me.TextRow.SetFocus
   Else
      Me.CMBStore.SetFocus
   End If
End If

If KeyCode = 116 Then
   Call CMDSave_Click
End If

If KeyCode = 117 Then
Dim vRowCode As String

   vRowCode = InputBox("RowCode :", "กรอกข้อมูล RowCode ที่นับสต๊อก")
   If vRowCode <> "" Then
       Me.TextRow.Text = vRowCode
       Call TextRow_LostFocus
       Me.TextShelf.SetFocus
   Else
      Me.TextRow.SetFocus
   End If
End If

If KeyCode = 118 Then
Dim vShelfCode As String

   vShelfCode = InputBox("ที่เก็บ :", "กรอกข้อมูล ShelfCode ที่นับสต๊อก")
   If vShelfCode <> "" Then
      Me.TextShelf.Text = vShelfCode
      Call TextShelf_LostFocus
      Me.TextScanBarcode.SetFocus
   Else
      Me.TextShelf.SetFocus
   End If
End If
End Sub

Private Sub TextShelf_KeyPress(KeyAscii As Integer)
Dim vRecordset As New ADODB.Recordset
Dim vCountShelf As Integer
Dim vWHCode As String
Dim vStoreCode As String
Dim vRow As String
Dim vShelf As String

On Error Resume Next

If KeyAscii = 13 And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" And Me.TextShelf.Text <> "" Then
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRow = Me.TextRow.Text
   vShelf = Me.TextShelf.Text
   
   vQuery = "exec dbo.USP_MB_SearchShelfMaster '" & vWHCode & "','" & vStoreCode & "','" & vRow & "','" & vShelf & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      vCountShelf = 1
   Else
      vCountShelf = 0
   End If
  vRecordset.Close
  
  If vCountShelf = 0 Then
     MsgBox "คลัง " & vWHCode & " และ Row  " & vRow & " ไม่มีทะเบียนที่เก็บ " & vShelf & " กรุณาตรวจสอบ", vbInformation, "Send Error Message"
     Me.TextShelf.Text = ""
     Me.TextShelf.SetFocus
  Else
     Me.TextShelf.Text = UCase(Me.TextShelf.Text)
     Me.TextScanBarcode.SetFocus
  End If
End If
End Sub

Private Sub TextShelf_LostFocus()
Call TextShelf_KeyPress(13)
End Sub

Public Sub vGetDataFromMC3000()
Dim vRecordset As New ADODB.Recordset
Dim vDocDate As String
Dim vCountID As String
Dim vWHCode As String
Dim vStoreCode As String
Dim vRowID As String
Dim i As Integer
Dim vCountStock As Double
Dim vOnHand As Double
Dim vListItem As ListItem

On Error Resume Next

If Me.MEBCountID1.Text <> "__/__" And Me.CMBWHCode.Text <> "" And Me.CMBStore.Text <> "" And Me.TextRow.Text <> "" Then
   vDocDate = Me.DTPDocDate.Day & "/" & Me.DTPDocDate.Month & "/" & Me.DTPDocDate.Year
   vCountID = Me.MEBCountID1.Text
   vWHCode = Me.CMBWHCode.Text
   vStoreCode = Me.CMBStore.Text
   vRowID = Me.TextRow.Text
   
   vQuery = "exec dbo.USP_MB_SearchCountItemDetails '" & vDocDate & "','" & vCountID & "','" & vWHCode & "','" & vStoreCode & "','" & vRowID & "' "
   If OpenDataBase(gConnection, vRecordset, vQuery) <> 0 Then
      Me.ListViewItemList.ListItems.Clear
      
      vGetIsConfirm = vRecordset.Fields("isconfirm").Value
      vGetIsFinish = vRecordset.Fields("isfinish").Value
      vGetIsCancel = vRecordset.Fields("iscancel").Value
      vGetIsRecQTY = vRecordset.Fields("isrecqty").Value
      
      If vGetIsCancel = 0 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         Me.IMGNew.Visible = True
         Me.IMGCancel.Visible = False
         Me.IMGConfirm.Visible = False
      ElseIf vGetIsCancel = 1 And vGetIsConfirm = 0 And vGetIsFinish = 0 Then
         Me.IMGNew.Visible = False
         Me.IMGCancel.Visible = True
         Me.IMGConfirm.Visible = False
         Me.CMDCancel.Enabled = False
      ElseIf vGetIsCancel = 0 And vGetIsConfirm = 1 And vGetIsFinish = 0 Then
         Me.IMGNew.Visible = False
         Me.IMGCancel.Visible = False
         Me.IMGConfirm.Visible = True
         Me.CMDCancel.Enabled = True
      ElseIf vGetIsCancel = 0 And vGetIsConfirm = 1 And vGetIsFinish = 1 Then
         Me.IMGNew.Visible = False
         Me.IMGCancel.Visible = False
         Me.IMGConfirm.Visible = True
         Me.CMDCancel.Enabled = True
      End If
      
      If vRecordset.Fields("percentdiff").Value <> 0 Then
      Me.MEBPercentDiff.Mask = Format(vRecordset.Fields("percentdiff").Value, "##,##0.00")
      Else
      Me.MEBPercentDiff.SelText = "__"
      End If
      vRecordset.MoveFirst
      i = 1
      While Not vRecordset.EOF
      Set vListItem = Me.ListViewItemList.ListItems.Add(, , i)
      vListItem.SubItems(1) = vRecordset.Fields("itemcode").Value
      vListItem.SubItems(2) = vRecordset.Fields("itemname").Value
      If vRecordset.Fields("count1").Value <> -1 Then
         vListItem.SubItems(3) = Format(vRecordset.Fields("count1").Value, "##,##0.00")
      Else
         vListItem.SubItems(3) = ""
      End If
      If vRecordset.Fields("count2").Value <> -1 Then
         vListItem.SubItems(4) = Format(vRecordset.Fields("count2").Value, "##,##0.00")
      Else
         vListItem.SubItems(4) = ""
      End If
      If vRecordset.Fields("count3").Value <> -1 Then
         vListItem.SubItems(5) = Format(vRecordset.Fields("count3").Value, "##,##0.00")
      Else
         vListItem.SubItems(5) = ""
      End If
      If IsNull(vRecordset.Fields("countqty").Value) Then
         vCountStock = 0
      Else
         vCountStock = vRecordset.Fields("countqty").Value
      End If
      
      If IsNull(vRecordset.Fields("onhand").Value) Then
         vOnHand = 0
      Else
         vOnHand = vRecordset.Fields("onhand").Value
      End If
      
      vListItem.SubItems(6) = vRecordset.Fields("unitcode").Value
      vListItem.SubItems(7) = Format(vOnHand, "##,##0.00")
      vListItem.SubItems(8) = Format(vCountStock - vOnHand, "##,##0.00")
      If vCountStock <> 0 Then
         If vOnHand <> 0 Then
            vListItem.SubItems(9) = Format((100 - (vCountStock * 100) / vOnHand), "##,##0.00")
         Else
            vListItem.SubItems(9) = Format(100, "##,##0.00")
         End If
      Else
        vListItem.SubItems(9) = Format(100, "##,##0.00")
      End If
      vListItem.SubItems(10) = vRecordset.Fields("shelfcode").Value
      
      Me.ListViewItemList.ListItems(i).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(1).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(2).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(3).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(4).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(5).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(6).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(7).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(8).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(9).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(10).ForeColor = "&H00000040"
      Me.ListViewItemList.ListItems(i).ListSubItems(11).ForeColor = "&H00000040"
      vRecordset.MoveNext
      i = i + 1
      Wend
      
      If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) And Me.ListViewItemList.ListItems.Count > 0 Then
         Me.OPT001.Value = False
         Me.OPT002.Value = True
      Else
         Me.OPT001.Value = True
         Me.OPT002.Value = False
      End If
      
      If vGetIsCancel = 1 Then
         Call DisableButton
      ElseIf vGetIsConfirm = 1 And vGetIsRecQTY = 0 Then
         Me.CMDSave.Enabled = False
         Me.CMDCloseProcess.Enabled = False
         Me.CMDProcess.Enabled = False
         Me.CMDTransfer.Enabled = False
         Me.CMDCloseCountStock.Enabled = False
         Me.CMDConfirmQTY.Enabled = True
      ElseIf vGetIsRecQTY = 1 Then
         Me.CMDSave.Enabled = False
         Me.CMDCloseProcess.Enabled = False
         Me.CMDProcess.Enabled = False
         Me.CMDTransfer.Enabled = True
         Me.CMDCloseCountStock.Enabled = False
         Me.CMDConfirmQTY.Enabled = True
      ElseIf vGetIsFinish = 1 Then
         Call DisableButton
      Else
         Call EnableButton
      End If
      vIsOpen = 1
   Else
      Me.ListViewItemList.ListItems.Clear
      vIsOpen = 0
      vGetIsCancel = 0
      vGetIsConfirm = 0
      vGetIsFinish = 0
      Me.IMGNew.Visible = True
      Me.IMGCancel.Visible = False
      Me.IMGConfirm.Visible = False
      Me.LBLShowDetailsAddItem.Caption = ""
         
      Call EnableButton
   End If
   vRecordset.Close
   
      If Me.DTPDocDate.Day < Day(Now) And Me.DTPDocDate.Month >= Month(Now) And Me.DTPDocDate.Year >= Year(Now) And Me.ListViewItemList.ListItems.Count > 0 Then
         Me.OPT001.Value = False
         Me.OPT002.Value = True
      Else
         Me.OPT001.Value = True
         Me.OPT002.Value = False
      End If
      
End If
End Sub
